<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analyse vidéo de mes habiletés sportives</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet">
<style>
:root{--bg:#0f1117;--surface:#1a1d27;--surface2:#222638;--border:#2e3349;--accent:#4f9cf9;--accent2:#f97316;--accent3:#22d3a0;--text:#e8eaf2;--muted:#8890a8;}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;font-weight:300;min-height:100vh;overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(79,156,249,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(79,156,249,.03) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;z-index:0;}
.container{max-width:900px;margin:0 auto;padding:48px 24px 80px;position:relative;z-index:1;}
header{text-align:center;margin-bottom:48px;}
.label-top{font-family:'Syne',sans-serif;font-size:10px;font-weight:700;letter-spacing:.25em;text-transform:uppercase;color:var(--accent);margin-bottom:16px;display:block;}
h1{font-family:'Syne',sans-serif;font-size:clamp(24px,4.5vw,42px);font-weight:800;line-height:1.1;color:var(--text);margin-bottom:12px;}
h1 span{color:var(--accent);}
.subtitle{color:var(--muted);font-size:14px;line-height:1.6;max-width:520px;margin:0 auto;}
.progress-bar{display:flex;align-items:center;gap:8px;margin-bottom:36px;justify-content:center;}
.step-dot{width:8px;height:8px;border-radius:50%;background:var(--border);transition:all .3s;}
.step-dot.active{background:var(--accent);width:24px;border-radius:4px;}
.step-dot.done{background:var(--accent3);}
@keyframes slideIn{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:translateY(0);}}
.card{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:36px;margin-bottom:20px;position:relative;overflow:hidden;animation:slideIn .35s cubic-bezier(.16,1,.3,1);}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--accent),transparent);}
.step-tag{font-family:'Syne',sans-serif;font-size:10px;font-weight:700;letter-spacing:.2em;text-transform:uppercase;color:var(--accent);margin-bottom:12px;display:block;}
.card h2{font-family:'Syne',sans-serif;font-size:clamp(17px,2.5vw,22px);font-weight:700;color:var(--text);margin-bottom:8px;line-height:1.3;}
.card>p{color:var(--muted);font-size:14px;line-height:1.7;margin-bottom:20px;}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;}
.form-group{display:flex;flex-direction:column;gap:6px;}
.form-group label{font-size:11px;font-weight:600;letter-spacing:.1em;text-transform:uppercase;color:var(--muted);}
.form-group input,.form-group textarea{background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:12px 14px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;outline:none;transition:border-color .2s;resize:vertical;}
.form-group input:focus,.form-group textarea:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(79,156,249,.1);}
.form-group input::placeholder,.form-group textarea::placeholder{color:var(--muted);opacity:.6;}
.form-group textarea{min-height:60px;}
.hint{font-size:11px;color:var(--muted);font-style:italic;margin-top:4px;line-height:1.5;}
.required-badge{color:#f43f5e;font-size:11px;margin-left:4px;}
.obj-section{background:rgba(79,156,249,.04);border:1px solid rgba(79,156,249,.12);border-radius:12px;padding:20px;margin-bottom:16px;}
.obj-section-title{font-family:'Syne',sans-serif;font-size:11px;font-weight:700;letter-spacing:.15em;text-transform:uppercase;color:var(--accent);margin-bottom:16px;}
.obj-item{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:18px;margin-bottom:12px;}
.obj-item-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;}
.obj-num{font-family:'Syne',sans-serif;font-size:11px;font-weight:700;color:var(--accent);letter-spacing:.1em;}
.btn-remove-obj{background:rgba(244,63,94,.1);border:1px solid rgba(244,63,94,.2);border-radius:6px;padding:4px 10px;color:#f43f5e;font-size:11px;font-weight:600;cursor:pointer;transition:all .2s;}
.btn-remove-obj:hover{background:rgba(244,63,94,.2);}
.indicators-list{display:flex;flex-direction:column;gap:8px;margin-top:12px;}
.indicator-row{display:flex;gap:8px;align-items:flex-start;}
.indicator-row input{flex:1;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:10px 12px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;outline:none;transition:border-color .2s;}
.indicator-row input:focus{border-color:var(--accent);}
.indicator-row input::placeholder{color:var(--muted);opacity:.6;}
.btn-remove-ind{background:transparent;border:1px solid var(--border);border-radius:6px;padding:10px;color:var(--muted);font-size:12px;cursor:pointer;transition:all .2s;flex-shrink:0;}
.btn-remove-ind:hover{border-color:#f43f5e;color:#f43f5e;}
.btn-add-indicator{background:transparent;border:1px dashed rgba(79,156,249,.3);border-radius:8px;padding:8px 14px;color:var(--accent);font-size:12px;font-weight:500;cursor:pointer;transition:all .2s;width:100%;margin-top:8px;}
.btn-add-indicator:hover{background:rgba(79,156,249,.06);border-color:var(--accent);}
.btn-add-obj{background:transparent;border:1px dashed rgba(79,156,249,.3);border-radius:10px;padding:12px;color:var(--accent);font-size:13px;font-weight:500;cursor:pointer;transition:all .2s;width:100%;display:flex;align-items:center;justify-content:center;gap:8px;}
.btn-add-obj:hover{background:rgba(79,156,249,.06);border-color:var(--accent);}
.btn-add-obj:disabled{opacity:.3;cursor:not-allowed;}
.ind-hint{font-size:11px;color:var(--muted);font-style:italic;margin-top:6px;line-height:1.5;padding:8px 10px;background:rgba(255,255,255,.03);border-radius:6px;}
.btn-primary{background:var(--accent);border:none;border-radius:10px;padding:14px 28px;color:#fff;font-family:'Syne',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:all .2s;width:100%;margin-top:8px;letter-spacing:.05em;}
.btn-primary:hover{background:#3a8ae8;transform:translateY(-2px);box-shadow:0 8px 24px rgba(79,156,249,.3);}
.choices{display:flex;flex-direction:column;gap:10px;}
.choice-btn{background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:16px 20px;text-align:left;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:14px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;line-height:1.5;}
.choice-btn:hover{background:var(--surface);border-color:var(--accent);transform:translateX(4px);}
.choice-icon{width:40px;height:40px;border-radius:10px;background:rgba(79,156,249,.1);display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;}
.choice-btn strong{display:block;font-weight:600;margin-bottom:3px;color:var(--text);}
.choice-btn span{font-size:12px;color:var(--muted);}

/* Observation panel */
.obs-panel{background:rgba(79,156,249,.04);border:1px solid rgba(79,156,249,.15);border-radius:14px;padding:24px;margin-bottom:20px;animation:slideIn .3s cubic-bezier(.16,1,.3,1);}
.obs-panel-title{font-family:'Syne',sans-serif;font-size:11px;font-weight:700;letter-spacing:.2em;text-transform:uppercase;color:var(--accent);margin-bottom:16px;display:flex;align-items:center;gap:8px;}
.obs-example{background:rgba(0,0,0,.2);border-radius:8px;padding:12px 16px;margin-bottom:16px;border-left:3px solid var(--accent);}
.obs-example .ex-label{font-size:10px;font-weight:700;letter-spacing:.15em;text-transform:uppercase;color:var(--accent);margin-bottom:6px;}
.obs-example p{font-size:13px;color:var(--text);line-height:1.6;margin:0;}
.check-list{display:flex;flex-direction:column;gap:8px;margin-bottom:16px;}
.check-item{display:flex;align-items:flex-start;gap:12px;padding:10px 14px;background:var(--surface);border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all .2s;}
.check-item:hover{border-color:var(--accent);background:rgba(79,156,249,.04);}
.check-item input[type=checkbox]{width:16px;height:16px;accent-color:var(--accent);cursor:pointer;flex-shrink:0;margin-top:2px;}
.check-item label{font-size:13px;color:var(--text);cursor:pointer;line-height:1.5;}
.check-item.checked{border-color:var(--accent3);background:rgba(34,211,160,.05);}
.check-item.checked label{color:var(--accent3);}
.obs-free{width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:12px 14px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;outline:none;resize:vertical;min-height:72px;transition:border-color .2s;}
.obs-free:focus{border-color:var(--accent);}
.obs-free::placeholder{color:var(--muted);opacity:.6;}
.obs-free-label{font-size:11px;font-weight:600;letter-spacing:.1em;text-transform:uppercase;color:var(--muted);margin-bottom:6px;display:block;}

/* Yesno */
.yesno{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:16px;}
.btn-yes{background:rgba(34,211,160,.1);border:1px solid rgba(34,211,160,.3);border-radius:12px;padding:16px 20px;cursor:pointer;color:var(--accent3);font-family:'Syne',sans-serif;font-weight:700;font-size:14px;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:8px;}
.btn-yes:hover{background:rgba(34,211,160,.2);transform:translateY(-2px);}
.btn-no{background:rgba(249,115,22,.1);border:1px solid rgba(249,115,22,.3);border-radius:12px;padding:16px 20px;cursor:pointer;color:var(--accent2);font-family:'Syne',sans-serif;font-weight:700;font-size:14px;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:8px;}
.btn-no:hover{background:rgba(249,115,22,.2);transform:translateY(-2px);}
.nav-btns{display:flex;gap:12px;margin-top:20px;flex-wrap:wrap;}
.btn-back{background:transparent;border:1px solid var(--border);border-radius:10px;padding:12px 20px;color:var(--muted);font-family:'DM Sans',sans-serif;font-size:13px;cursor:pointer;transition:all .2s;}
.btn-back:hover{border-color:var(--accent);color:var(--text);}
.btn-restart{background:rgba(79,156,249,.1);border:1px solid rgba(79,156,249,.3);border-radius:10px;padding:12px 20px;color:var(--accent);font-family:'Syne',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all .2s;}
.btn-restart:hover{background:rgba(79,156,249,.2);transform:translateY(-2px);}
.breadcrumb{display:flex;align-items:center;gap:6px;flex-wrap:wrap;margin-bottom:20px;font-size:12px;color:var(--muted);}
.breadcrumb span{color:var(--accent);font-weight:500;}
.breadcrumb .sep{opacity:.4;}
.validation-error{color:#f43f5e;font-size:12px;margin-top:8px;display:none;}

/* Result */
.result-card{border-radius:16px;padding:36px;margin-bottom:20px;animation:slideIn .4s cubic-bezier(.16,1,.3,1);}
.result-header{display:flex;align-items:flex-start;gap:20px;margin-bottom:24px;}
.family-badge{width:56px;height:56px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0;}
.result-card h2{font-family:'Syne',sans-serif;font-size:clamp(17px,2.5vw,22px);font-weight:800;line-height:1.2;margin-bottom:4px;}
.family-label{font-size:11px;font-weight:700;letter-spacing:.15em;text-transform:uppercase;opacity:.7;}
.result-section{background:rgba(0,0,0,.2);border-radius:10px;padding:16px 20px;margin-bottom:12px;}
.result-section-title{font-family:'Syne',sans-serif;font-size:10px;font-weight:700;letter-spacing:.2em;text-transform:uppercase;margin-bottom:8px;opacity:.6;}
.result-section p{font-size:14px;line-height:1.7;color:var(--text);margin:0;}
.objective-box{border-radius:10px;padding:20px;margin-bottom:12px;border-left:3px solid currentColor;}
.obj-label{font-family:'Syne',sans-serif;font-size:10px;font-weight:700;letter-spacing:.2em;text-transform:uppercase;margin-bottom:10px;}
.objective-box p{font-size:14px;line-height:1.7;margin:0;}
.sep-line{height:1px;background:var(--border);margin:24px 0;}

/* Deep dive panel */
.deep-dive{background:rgba(250,204,21,.04);border:1px solid rgba(250,204,21,.15);border-radius:14px;padding:24px;margin-bottom:20px;animation:slideIn .4s cubic-bezier(.16,1,.3,1);}
.deep-dive h3{font-family:'Syne',sans-serif;font-size:12px;font-weight:700;letter-spacing:.2em;text-transform:uppercase;color:#facc15;margin-bottom:6px;}
.deep-dive .dd-desc{font-size:13px;color:var(--muted);margin-bottom:16px;line-height:1.6;}
.deep-check{display:flex;flex-direction:column;gap:8px;margin-bottom:16px;}
.deep-check-item{display:flex;align-items:flex-start;gap:12px;padding:10px 14px;background:var(--surface);border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all .2s;}
.deep-check-item:hover{border-color:#facc15;background:rgba(250,204,21,.04);}
.deep-check-item input[type=checkbox]{width:16px;height:16px;accent-color:#facc15;cursor:pointer;flex-shrink:0;margin-top:2px;}
.deep-check-item label{font-size:13px;color:var(--text);cursor:pointer;line-height:1.5;}
.deep-check-item.checked{border-color:#facc15;background:rgba(250,204,21,.06);}

/* Summary */
.summary-card{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:36px;margin-bottom:20px;}
.summary-card h3{font-family:'Syne',sans-serif;font-size:14px;font-weight:700;color:var(--accent);letter-spacing:.1em;text-transform:uppercase;margin-bottom:20px;padding-bottom:12px;border-bottom:1px solid var(--border);}
.summary-row{display:flex;justify-content:space-between;align-items:flex-start;padding:10px 0;border-bottom:1px solid rgba(255,255,255,.04);gap:16px;}
.summary-row:last-child{border-bottom:none;}
.summary-label{font-size:12px;color:var(--muted);font-weight:500;min-width:160px;}
.summary-value{font-size:13px;color:var(--text);text-align:right;flex:1;}
.summary-highlight{background:rgba(79,156,249,.06);border:1px solid rgba(79,156,249,.15);border-radius:10px;padding:16px 20px;margin-top:12px;}
.summary-highlight .sh-label{font-size:10px;font-weight:700;letter-spacing:.2em;text-transform:uppercase;color:var(--accent);margin-bottom:6px;}
.summary-highlight p{font-size:13px;line-height:1.7;color:var(--text);}
.obs-summary-block{background:rgba(0,0,0,.15);border-radius:8px;padding:12px 16px;margin-top:8px;}
.obs-summary-block .osb-label{font-size:10px;font-weight:700;letter-spacing:.15em;text-transform:uppercase;color:var(--muted);margin-bottom:6px;}
.obs-summary-block ul{list-style:none;padding:0;margin:0;}
.obs-summary-block li{font-size:12px;color:var(--muted);padding:2px 0 2px 10px;border-left:2px solid rgba(79,156,249,.3);margin-bottom:3px;}

/* Revised */
.revised-section{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:36px;margin-bottom:20px;}
.revised-section h3{font-family:'Syne',sans-serif;font-size:14px;font-weight:700;color:var(--accent3);letter-spacing:.1em;text-transform:uppercase;margin-bottom:8px;padding-bottom:12px;border-bottom:1px solid var(--border);}
.revised-section .section-desc{font-size:13px;color:var(--muted);margin-bottom:20px;line-height:1.6;}
.rev-global{background:rgba(34,211,160,.06);border:1px solid rgba(34,211,160,.2);border-radius:10px;padding:16px 20px;margin-bottom:20px;}
.rev-global label{font-size:11px;font-weight:700;letter-spacing:.15em;text-transform:uppercase;color:var(--accent3);display:block;margin-bottom:8px;}
.rev-global textarea{width:100%;background:var(--surface2);border:1px solid rgba(34,211,160,.2);border-radius:8px;padding:12px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;outline:none;resize:vertical;min-height:56px;}
.rev-global textarea:focus{border-color:var(--accent3);}
.rev-obj-item{background:rgba(34,211,160,.04);border:1px solid rgba(34,211,160,.15);border-radius:10px;padding:18px;margin-bottom:12px;}
.rev-obj-item label{font-size:11px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--accent3);display:block;margin-bottom:8px;}
.rev-obj-item input{width:100%;background:var(--surface2);border:1px solid rgba(34,211,160,.2);border-radius:8px;padding:10px 12px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;outline:none;margin-bottom:10px;}
.rev-obj-item input:focus{border-color:var(--accent3);}
.rev-ind-row{display:flex;gap:8px;margin-bottom:6px;}
.rev-ind-row input{flex:1;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:9px 12px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:12px;outline:none;}
.rev-ind-row input:focus{border-color:var(--accent3);}
.btn-add-rev-ind{background:transparent;border:1px dashed rgba(34,211,160,.25);border-radius:6px;padding:7px 12px;color:var(--accent3);font-size:11px;cursor:pointer;transition:all .2s;margin-top:4px;}
.btn-add-rev-ind:hover{background:rgba(34,211,160,.06);}
.action-btns{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:20px;}
.btn-print{background:rgba(34,211,160,.1);border:1px solid rgba(34,211,160,.3);border-radius:10px;padding:14px 20px;color:var(--accent3);font-family:'Syne',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:8px;}
.btn-print:hover{background:rgba(34,211,160,.2);transform:translateY(-2px);}
.btn-copy{background:rgba(167,139,250,.1);border:1px solid rgba(167,139,250,.3);border-radius:10px;padding:14px 20px;color:#a78bfa;font-family:'Syne',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:8px;}
.btn-copy:hover{background:rgba(167,139,250,.2);transform:translateY(-2px);}
.copy-confirm{text-align:center;font-size:12px;color:var(--accent3);margin-top:10px;height:18px;}

@media print{
  body{background:white;color:black;}body::before{display:none;}
  .nav-btns,.action-btns,.progress-bar,header,.btn-add-obj,.btn-add-indicator,.btn-remove-obj,.btn-remove-ind,.btn-add-rev-ind,.obs-panel .yesno,.deep-dive .yesno{display:none!important;}
  .card,.summary-card,.result-card,.revised-section,.deep-dive,.obs-panel{border:1px solid #ccc;background:white;color:black;box-shadow:none;}
  .summary-label{color:#555;}.summary-value{color:#000;}
  .result-section{background:#f5f5f5;}.objective-box{background:#f0f4ff!important;}
  .result-section p,.objective-box p{color:#000!important;}
  input,textarea{background:white!important;border:1px solid #ccc!important;color:#000!important;}
  .breadcrumb,.check-list,.deep-check{display:none;}
  .obs-summary-block{display:block;}
}
@media(max-width:600px){.form-grid{grid-template-columns:1fr;}.yesno{grid-template-columns:1fr;}.action-btns{grid-template-columns:1fr;}}
</style>
</head>
<body>
<div class="container">
  <header>
    <span class="label-top">Éducation physique — Ensemble 2</span>
    <h1>Analyse vidéo de mes <span>habiletés sportives</span></h1>
    <p class="subtitle">Identifie ta famille d’erreurs prioritaire, formule tes objectifs et produis ton résumé d’analyse.</p>
  </header>
  <div class="progress-bar" id="progressBar">
    <div class="step-dot active" id="dot0"></div>
    <div class="step-dot" id="dot1"></div>
    <div class="step-dot" id="dot2"></div>
    <div class="step-dot" id="dot3"></div>
    <div class="step-dot" id="dot4"></div>
    <div class="step-dot" id="dot5"></div>
    <div class="step-dot" id="dot6"></div>
  </div>
  <div id="tree"></div>
</div>
<script>
var studentInfo={};
var navHistory=[];
var breadcrumbTrail=[];
var currentStep='ident';
var detectedFamily=null;
var stepObservations={};
var objCount=0;
var indCounters={};
var revObjCount=0;
var revIndCounters={};

// ── Activity detection ────────────────────────────────────────────────────────
function detectActivity(s){
  s=(s||'').toLowerCase();
  if(/natation|crawl|nage|brasse|papillon|dos crawl/.test(s)) return 'natation';
  if(/basket|basketball/.test(s)) return 'basket';
  if(/tennis|badminton|squash|raquette/.test(s)) return 'raquette';
  if(/soccer|football|foot/.test(s)) return 'soccer';
  if(/yoga|pilates/.test(s)) return 'yoga';
  if(/course|sprint|jogging|athl|marathon|demi-fond|fond/.test(s)) return 'course';
  if(/ski|snowboard|glisse/.test(s)) return 'ski';
  if(/art martial|judo|ka[rk]at|ta.kwondo|boxe|lutte|mma|jiujitsu|jiu.jitsu|kung.fu|krav|aikido/.test(s)) return 'martial';
  if(/volley/.test(s)) return 'volley';
  if(/hockey/.test(s)) return 'hockey';
  if(/golf/.test(s)) return 'golf';
  if(/cycl|velo|vtt|triathlon/.test(s)) return 'cyclisme';
  if(/danse|contemporain|hip.hop|ballet|salsa|jazz/.test(s)) return 'danse';
  if(/gymn|acrobat|trampoline/.test(s)) return 'gym';
  if(/escalade|grimpe|bloc/.test(s)) return 'escalade';
  if(/aviron|canot|kayak|pagaie/.test(s)) return 'aviron';
  if(/baseball|softball/.test(s)) return 'baseball';
  if(/rugby|ultimate|frisbee/.test(s)) return 'rugby';
  return 'general';
}

// ── Observation points per step per activity ──────────────────────────────────
var OBS = {
  // POSTURE DE DEPART
  posture:{
    natation:[
      "Mon corps est horizontal et aligné en surface (pas de jambes qui tombent)",
      "Ma tête est dans le prolongement de la colonne, regard vers le bas",
      "Mes épaules sont basses et détendues (pas contractées vers les oreilles)",
      "Mon bassin est à la surface ou légèrement sous la surface",
      "Mon corps ne pivote pas excessivement avant le début du mouvement de bras"
    ],
    basket:[
      "Mes pieds sont à largeur d’épaules ou légèrement plus larges",
      "Mes genoux sont fléchis (position athlétique)",
      "Mon poids est sur l’avant du pied (pas sur les talons)",
      "Mon tronc est légèrement penché vers l’avant",
      "Mon regard est dirigé vers la cible avant de déclencher le geste"
    ],
    raquette:[
      "Je suis en position d’attente (genoux fléchis, pieds actifs, poids équilibré)",
      "Ma raquette est tenue devant moi, bras décontracté",
      "Mon centre de gravité est bas pour permettre une réaction rapide",
      "Mes épaules sont décontractées et non contractées",
      "Mon regard suit la trajectoire de l’objet dès sa sortie"
    ],
    soccer:[
      "Mon poids est équilibré sur les deux appuis avant le geste",
      "Mes genoux sont légèrement fléchis, corps en position athlétique",
      "Mon tronc est orienté dans la bonne direction selon l’action",
      "Mon pied d’appui est positionné à côté du ballon (ni trop près ni trop loin)",
      "Mes épaules sont orientées vers la cible"
    ],
    yoga:[
      "Mon bassin est en position neutre (ni basculé en avant ni en arrière)",
      "Ma colonne est dans son alignement naturel (courbes respectées)",
      "Mes épaules sont éloignées des oreilles",
      "Mon poids est équilibré sur mes appuis (pieds ou mains)",
      "Mes articulations sont alignées (cheville-genou-hanche ou poignet-coude-épaule)"
    ],
    course:[
      "Mon tronc est légèrement incliné vers l’avant (pas droit ni courbé)",
      "Mon regard est dirigé devant, pas vers le sol",
      "Mes épaules sont basses et décontractées",
      "Mes bras sont fléchis à environ 90°",
      "Mes pieds attaquent le sol sous mon centre de gravité"
    ],
    ski:[
      "Mes genoux sont fléchis et orientés vers l’avant des skis",
      "Mon poids est centré sur le milieu du pied (ni talon ni pointe)",
      "Mon tronc est incliné vers l’avant, face à la pente",
      "Mes bâtons sont tenus en avant du corps, coudes fléchis",
      "Ma tête est relevée, regard vers le bas de la pente"
    ],
    martial:[
      "Ma garde est adaptée à la discipline (pieds à la bonne largeur, poids réparti)",
      "Mon centre de gravité est bas (flexion des genoux)",
      "Mes poings ou avant-bras protègent mon centre sans me bloquer",
      "Mon tronc est légèrement pivoté pour protéger la ligne centrale",
      "Mon regard est sur l’adversaire, pas sur ses membres"
    ],
    volley:[
      "Mon poids est sur l’avant du pied, genoux fléchis avant chaque action",
      "Mes bras sont devant moi, coudes légèrement fléchis en attente",
      "Mon regard est sur le ballon dès son envol",
      "Mon centre de gravité est bas pour permettre les déplacements rapides",
      "Mon tronc est droit et stable avant la frappe"
    ],
    hockey:[
      "Mes genoux sont fléchis, poids légèrement sur l’avant des patins",
      "Mon bâton est en position basse devant moi",
      "Mon tronc est incliné vers l’avant, dos plat (pas arrondi)",
      "Mon regard est sur la rondelle ou l’espace de jeu",
      "Mon poids est centré sur les deux patins avant l’action"
    ],
    golf:[
      "Mes pieds sont à largeur d’épaules, orteils légèrement vers l’extérieur",
      "Mes genoux sont légèrement fléchis (ni raides ni trop pliés)",
      "Mon dos est droit et incliné vers la balle (flexion depuis les hanches)",
      "Mon poids est équilibré sur les deux pieds, au milieu du pied",
      "Mes bras tombent naturellement, les mains sous les épaules"
    ],
    cyclisme:[
      "Mon dos est plat (pas arrondi) en position de pédalage",
      "Mes épaules sont décontractées, coudes légèrement fléchis",
      "Ma position sur la selle permet une légère flexion du genou en bas de pédale",
      "Ma tête est dans le prolongement de la colonne (pas trop levée)",
      "Mon bassin est stable sur la selle (pas de balancement latéral)"
    ],
    danse:[
      "Mon axe central est vertical, crâne dans le prolongement de la colonne",
      "Mes épaules sont basses et ouvertes (pas rentrées)",
      "Mon bassin est en position neutre",
      "Mon poids est sur l’avant du pied selon le style",
      "Mon regard est orienté selon la chorégraphie (pas vers le sol par défaut)"
    ],
    gym:[
      "Mon corps est aligné de la tête aux pieds dans les positions de gainage",
      "Mes épaules sont actives (pas passivement abaissées) en appui",
      "Mon bassin ne bascule pas en avant ou en arrière",
      "Mon regard est orienté selon l’exercice (neutre en gainage, devant en course)",
      "Mon centre de gravité est prêt pour l’action suivante"
    ],
    escalade:[
      "Mes hanches sont proches du mur (pas de fesses en arrière)",
      "Mon poids est sur mes pieds (pas entièrement dans mes bras)",
      "Mes bras sont légèrement fléchis (pas complètement tendus en permanence)",
      "Mon regard anticipe les prises suivantes, pas seulement la prise actuelle",
      "Mon corps est stable avant chaque mouvement de main"
    ],
    aviron:[
      "Mon dos est droit en phase de catch (entrée de rame dans l’eau)",
      "Ma compression est complète (genoux fléchis, corps légèrement en avant)",
      "Mes épaules sont basses, bras tendus avant la prise",
      "Mon regard est vers l’avant de l’embarcation",
      "Mon poids est centré sur les appuie-pieds"
    ],
    baseball:[
      "Mes pieds sont à largeur d’épaules, genoux fléchis en position d’attente",
      "Mon poids est sur l’arrière du pied (pied pivot) avant le swing",
      "Ma batte est en position haute, coudes actifs",
      "Mon regard est sur le lanceur dès sa préparation",
      "Mon tronc est orienté vers le receveur (pas encore ouvert)"
    ],
    rugby:[
      "Mon centre de gravité est bas avant le contact (genoux fléchis)",
      "Mon dos est droit dans les actions de contact",
      "Mon regard est sur la cible ou l’espace avant l’action",
      "Mon poids est équilibré avant le départ ou la réception",
      "Mes épaules sont orientées dans la direction de l’action"
    ],
    general:[
      "Mon centre de gravité est bas et stable avant le début du mouvement",
      "Mon poids est équilibré sur mes appuis",
      "Mon bassin est en position neutre (ni basculé ni bloqué)",
      "Mes épaules sont décontractées et alignées",
      "Mon regard est orienté vers la cible ou la direction de l’action"
    ]
  },
  // CHAINE CINETIQUE
  chaine:{
    natation:[
      "La rotation du tronc initie chaque coup de bras (le corps pivote avant le bras)",
      "Mon épaule entre en premier dans l’eau, pas ma main à plat",
      "Mon bras entre dans l’axe (ni trop à l’intérieur ni trop à l’extérieur)",
      "Mon coude reste élevé pendant la traction sous l’eau",
      "La poussée se termine jusqu’à la cuisse avant la sortie du bras"
    ],
    basket:[
      "Le mouvement commence par une flexion/extension des jambes",
      "L’énergie monte des jambes vers le tronc puis vers le bras",
      "Mon coude est aligné sous le ballon pendant la montée",
      "Ma main guide quitte le ballon avant le relâché (ne pousse pas)",
      "Mon poignet s’incline vers l’avant en fin de geste (effet de fouet)"
    ],
    raquette:[
      "La rotation des hanches précède la rotation des épaules",
      "La rotation des épaules précède le mouvement du bras",
      "Le bras et la raquette arrivent en dernier dans la chaîne",
      "Mon coude mène la raquette en phase de préparation",
      "La finition du geste se prolonge après le contact"
    ],
    soccer:[
      "Ma jambe d’appui est stable et plantée avant le coup de pied",
      "Le mouvement commence par la hanche (pas seulement le genou)",
      "Mon tronc se tourne vers la cible pour ajouter de la force",
      "Mon pied frappe avec la bonne surface (coupé = intérieur, puisé = cou-de-pied)",
      "Mon geste se prolonge vers la cible après le contact"
    ],
    yoga:[
      "L’initiation du mouvement part du centre (bassin/tronc) vers la périphérie",
      "Les articulations distales (mains, pieds) s’engagent après le centre",
      "Ma respiration accompagne le mouvement (expiration sur l’effort)",
      "Aucun segment ne se verrouille avant que le segment central soit stabilisé",
      "La transition entre deux postures passe par une position intermédiaire contrôlée"
    ],
    course:[
      "Ma foulée est initiée par la hanche (pas seulement la jambe)",
      "Mon bras balançoir est coordonné avec la jambe opposée",
      "Ma cheville se stabilise au moment de l’appui (propulsion efficace)",
      "Mon talon monte vers les fesses en phase de récupération (pas de traînage)",
      "Mon tronc reste stable sans rotation excessive des épaules"
    ],
    ski:[
      "La rotation débute par les hanches/bassin avant les genoux",
      "Les genoux guident la direction des skis",
      "Mes bras restent devant comme balançoir (pas de rotation des épaules)",
      "La prise de carre est initiée par la cheville avant le genou",
      "Mon poids se transfère d’un ski à l’autre de façon fluide"
    ],
    martial:[
      "La frappe ou le déplacement part du bassin/hanches (koshi/hara)",
      "L’épaule et le bras arrivent en dernier dans la chaîne de frappe",
      "Mon appui au sol est ferme au moment de l’impact",
      "Le déplacement de jambes précède la technique de bras",
      "L’énergie est relâchée au point d’impact, pas avant"
    ],
    volley:[
      "La frappe (smash) part de la rotation des épaules avant le bras",
      "Mon bras de frappe arrive en dernier après le balancement du tronc",
      "La manchette engage les jambes et le tronc, pas seulement les bras",
      "Mon impulsion au saut vient des jambes avant les bras",
      "La passe haute part des doigts en dernier dans la chaîne"
    ],
    hockey:[
      "Le tir part de la rotation des hanches avant les épaules",
      "Le transfert de poids (pied arrière vers avant) précède le tir",
      "Mes épaules tournent avant que le bâton n’accélère",
      "Le claquement de poignet arrive en tout dernier (effet de fouet)",
      "Mon tronc s’ouvre vers la cible avant la fin du geste"
    ],
    golf:[
      "Le down-swing s’initie par la rotation des hanches (pas les épaules)",
      "Les épaules suivent les hanches, les bras suivent les épaules",
      "Le club arrive en dernier dans la chaîne (accélération maximale à l’impact)",
      "Mon poids se transfère du pied arrière au pied avant pendant le swing",
      "Le back-swing monte de façon contrôlée depuis les épaules"
    ],
    cyclisme:[
      "La puissance vient de l’extension complète de la hanche avant le genou",
      "Mon genou pousse vers le bas en coordination avec la hanche",
      "La cheville accompagne (flexion/extension) le mouvement de pédale",
      "Mon tronc reste stable et ne compense pas le mouvement des jambes",
      "Les deux jambes travaillent en opposition coordonnée"
    ],
    danse:[
      "Le mouvement s’initie depuis le centre (bassin/plexus) selon le style",
      "Les membres s’engagent après le centre (bras et jambes en dernier)",
      "Chaque segment prolonge l’énergie du segment précédent",
      "La tête et le regard arrivent en dernier dans les turns",
      "Aucun segment ne se ferme avant que le suivant soit engagé"
    ],
    gym:[
      "En appel de saut : l’impulsion vient des jambes, puis le tronc s’élève",
      "En roulade : le dos suit segment par segment",
      "La réception : le contact sol remonte des pieds vers les genoux vers les hanches",
      "En suspension : les épaules s’activent avant les bras",
      "Le tronc initie les mouvements, les membres amplifient"
    ],
    escalade:[
      "Le mouvement de main vient après la stabilisation des pieds et des hanches",
      "La poussée vient des jambes (pas uniquement du tirage des bras)",
      "La rotation des hanches permet d’atteindre les prises éloignées",
      "L’énergie remonte du pied d’appui vers la main qui saisit",
      "Le corps se rapproche du mur par la hanche avant le bras"
    ],
    aviron:[
      "La poussée commence par l’extension des jambes (pas le débascul du dos)",
      "Le dos bascule en arrière après l’extension des jambes",
      "Les bras tirent en dernier dans la chaîne",
      "La récupération suit l’ordre inverse : bras, dos, jambes",
      "Chaque phase est complète avant la suivante"
    ],
    baseball:[
      "Le swing s’initie par la rotation des hanches (pas les épaules)",
      "Le transfert de poids (pied arrière vers avant) déclenche la chaîne",
      "Les bras et la batte arrivent en dernier (accélération maximale à l’impact)",
      "Les épaules suivent les hanches avec un léger décalage",
      "Le poignet claque en dernier lieu au moment du contact"
    ],
    rugby:[
      "Le pass vient de la rotation du tronc, les bras amplifient",
      "Le plaquage part des jambes et des hanches avant les épaules",
      "Le coup de pied suit la chaîne hanche-genou-pied",
      "L’élan du corps soutient chaque geste de bras",
      "Le pas de course engage les hanches avant les épaules"
    ],
    general:[
      "Le mouvement est initié par le tronc ou le bassin, pas par les membres",
      "L’énergie se propage segment par segment (proximal vers distal)",
      "Les membres supérieurs ou inférieurs arrivent en dernier dans la chaîne",
      "Aucun segment ne se verrouille trop tôt et ne bloque la propagation",
      "Le geste se prolonge naturellement après le point d’action"
    ]
  },
  // TIMING
  timing:{
    natation:[
      "Il y a une accélération visible en milieu de traction (pas une vitesse constante)",
      "La poussée finale du bras est plus rapide que la phase d’entrée",
      "Le battement de jambes s’intensifie au moment de la rotation du corps",
      "La sortie du bras de l’eau est rapide et détendue",
      "Il n’y a pas de pause ou de fléchissement entre l’entrée et la traction"
    ],
    basket:[
      "L’extension des jambes et celle du bras sont synchronisées",
      "Il y a une accélération visible au moment du relâché du ballon",
      "La montée du bras est continue sans pause intermédiaire",
      "Le ballon part au sommet de l’extension (pas avant, pas après)",
      "Le geste complet est fluide, sans saccades"
    ],
    raquette:[
      "L’accélération maximale de la raquette se produit au moment du contact",
      "La préparation (back-swing) est complète avant l’arrivée de la balle",
      "Le mouvement ne ralentit pas avant le contact",
      "La finition (follow-through) montre une décélération naturelle, pas forcée",
      "Le rythme préparation-contact-finition est fluide et continu"
    ],
    soccer:[
      "L’accélération du pied est maximale au moment du contact avec le ballon",
      "Le recul du pied (back-swing) est complet avant le contact",
      "Le contact est ferme et décisif (pas hésitant)",
      "Le suivi du mouvement (follow-through) se prolonge dans la direction visée",
      "Il n’y a pas de décélération visible avant le contact"
    ],
    yoga:[
      "La transition entre postures suit un rythme délibéré (ni trop rapide ni trop lent)",
      "Chaque position intermédiaire est contrôlée avant la suivante",
      "La respiration dicte le rythme du mouvement",
      "Il n’y a pas d’hésitation ou de perte de fluidité en milieu de transition",
      "L’effort s’intensifie au bon moment (expiration = effort maximal)"
    ],
    course:[
      "Le contact au sol est bref (pas de période d’appui prolongée)",
      "La propulsion se produit derrière le corps (pas sous lui)",
      "Le rythme bras-jambes est stable et coordonné",
      "La phase de vol est visible et proportionnelle à la vitesse",
      "Il n’y a pas de ralentissement perceptible entre les foulées"
    ],
    ski:[
      "L’engagement de la carre se produit au sommet du virage (pas trop tard)",
      "Le transfert de poids d’un ski à l’autre est fluide et au bon moment",
      "Le planté de bâton déclenche la rotation des hanches",
      "La phase de glisse est utilisée, pas perdue en freinage",
      "L’accélération est visible en sortie de virage"
    ],
    martial:[
      "La vitesse maximale est atteinte juste avant ou au point d’impact",
      "La frappe ne commence pas à décélérer avant le contact",
      "La récupération (retrait de la technique) est rapide",
      "Le déplacement de jambes et la technique de bras sont synchronisés",
      "Il n’y a pas de télégraphie (annonce visible du geste avant son exécution)"
    ],
    volley:[
      "L’accélération du bras de frappe est maximale au contact du ballon",
      "L’impulsion au saut est complète avant la frappe (pas en montée)",
      "La préparation du bras est complète avant l’arrivée du ballon",
      "La finition du geste de smash est ample et naturelle après le contact",
      "Il n’y a pas de pause entre la montée et la frappe"
    ],
    hockey:[
      "L’accélération du bâton est maximale au moment du contact avec la rondelle",
      "Le claquement de poignet se produit au bon moment selon le tir",
      "Il n’y a pas de pause entre le chargement et le tir",
      "La vitesse du bâton augmente du début jusqu’à l’impact",
      "Le transfert de poids précède le tir (timing coordonné)"
    ],
    golf:[
      "Le down-swing accélère progressivement jusqu’à l’impact",
      "Il n’y a pas de décélération avant l’impact",
      "Le rythme back-swing/down-swing est fluide (environ 3:1)",
      "Le follow-through est long et naturel après l’impact",
      "L’impact se produit quand le club est au bas de l’arc de swing"
    ],
    cyclisme:[
      "La puissance maximale est appliquée entre 3h et 6h sur le cadran de la pédale",
      "En sprint : l’accélération est progressive et soutenue jusqu’à la ligne",
      "La cadence est maintenue de façon constante",
      "La poussée et la traction sont bien coordonnées",
      "Les deux jambes ont un rythme régulier sans à-coups"
    ],
    danse:[
      "Chaque mouvement arrive au bon temps de la musique",
      "Les accents musicaux correspondent aux accents du mouvement",
      "L’accélération et la décélération suivent le phrasé musical",
      "Les transitions entre mouvements sont fluides et sans temps mort",
      "La préparation du mouvement suivant est amorcée avant la fin du mouvement en cours"
    ],
    gym:[
      "L’impulsion au saut est explosive et complète",
      "La réception absorbe l’énergie de façon contrôlée",
      "Le moment d’élévation est clairement identifiable dans le geste",
      "Les rotations ont une vitesse contrôlée",
      "Il n’y a pas de pause involontaire au sommet du saut"
    ],
    escalade:[
      "Le mouvement est déclenché quand les trois points d’appui sont stables",
      "La saisie de la prise se fait avec précision",
      "Il n’y a pas de pause inutile entre deux mouvements",
      "La vitesse est adaptée au type de voie",
      "Le déplacement est fluide : l’arrêt ne vient que si nécessaire"
    ],
    aviron:[
      "Le catch (entrée de rame) est précis et au bon moment",
      "La poussée des jambes est explosive au début du drive",
      "La récupération est plus lente que le drive",
      "La transition entre le drive et la récupération est fluide",
      "Le rythme drive/récupération est régulier et soutenu"
    ],
    baseball:[
      "Le swing démarre au bon moment par rapport au lancer",
      "L’accélération de la batte est maximale au contact",
      "Il n’y a pas de ralentissement avant le contact",
      "Le follow-through est complet et naturel après le contact",
      "Le rythme chargement/swing est fluide et continu"
    ],
    rugby:[
      "Le pass est libéré au bon moment selon la position du soutien",
      "Il n’y a pas d’hésitation visible avant les décisions motrices",
      "L’accélération dans la course est maximale avant le contact",
      "Le plaquage est déclenché quand le porteur est à portée",
      "La prise de décision est rapide et décisive"
    ],
    general:[
      "Il y a une phase d’accélération visible dans le geste (pas une vitesse constante)",
      "L’accélération maximale se produit au bon moment (point d’action ou d’impact)",
      "Le geste ne ralentit pas avant le point d’action",
      "La finition du mouvement est fluide et naturelle",
      "Le rythme global du mouvement est continu et sans saccades"
    ]
  },
  // TENSION MUSCULAIRE
  tension:{
    natation:[
      "Mes épaules ne remontent pas vers les oreilles pendant la nage",
      "Ma mâchoire est décontractée (pas de dents serrées visible)",
      "Mon cou n’est pas tendu lors de la respiration",
      "Mes mains entrent dans l’eau de façon détendue (doigts séparés, pas crampés)",
      "La tension augmente clairement quand je suis fatigué ou pressé"
    ],
    basket:[
      "Mes épaules sont basses et décontractées pendant l’envol du tir",
      "Mon visage ne montre pas de grimace d’effort excessif",
      "Ma main de soutien ne pousse pas sur le ballon au moment du relâché",
      "Mon poignet est souple (pas bloqué) au moment du tir",
      "La tension apparaît ou augmente quand je suis surveillé ou pressé"
    ],
    raquette:[
      "Ma prise de raquette n’est pas trop serrée (règle des 3 doigts)",
      "Mon avant-bras n’est pas contracté en permanence entre les échanges",
      "Mes épaules descendent entre les points (pas de tension accumulée)",
      "Mon visage est décontracté pendant la frappe",
      "La tension s’accentue en fin de match ou sous pression"
    ],
    soccer:[
      "Mes bras sont décontractés et ne se contractent pas inutilement pendant le geste",
      "Mes épaules ne se crispent pas avant la frappe",
      "Mon pied de frappe n’est pas crampé ou excessivement rigidé avant le contact",
      "Mon visage ne montre pas de grimace d’effort excessif",
      "La tension est davantage présente en situation de match que à l’entraînement"
    ],
    yoga:[
      "Mes épaules s’éloignent des oreilles dans toutes les positions",
      "Ma mâchoire et mon visage sont décontractés en cours de posture",
      "Mes mains ne se contractent pas quand elles ne sont pas en appui",
      "Ma respiration reste fluide (elle ne se bloque pas dans les positions difficiles)",
      "Les segments du corps au repos (qui ne portent pas) sont détendus"
    ],
    course:[
      "Mes poings ne sont pas serrés (main formée comme si je tenais un œuf)",
      "Mes épaules restent basses et n’oscillent pas vers le haut",
      "Mon visage et ma mâchoire sont décontractés",
      "Ma nuque et mon cou ne sont pas tendus",
      "La tension apparaît clairement en fin de course ou en montée"
    ],
    ski:[
      "Mes bras ne sont pas contractés ou collés au corps",
      "Mes mâchoires et mon visage sont décontractés dans les passages difficiles",
      "Mes pieds ne serrent pas les chaussures excessivement",
      "Mes genoux ne sont pas bloqués (ils absorbent les irrégularités)",
      "La tension augmente sur les pistes difficiles ou en présence de public"
    ],
    martial:[
      "Mes épaules ne remontent pas avant chaque technique",
      "Mon visage ne se contracte pas avant la frappe (signalement involontaire)",
      "Mes segments en repos (bras non actif, jambe d’appui) sont détendus",
      "Ma prise est ferme au point d’impact, mais décontractée avant et après",
      "La tension globale augmente quand l’adversaire est actif ou imprévisible"
    ],
    volley:[
      "Mes épaules sont basses entre les actions (pas accumulation de tension)",
      "Mon cou et ma mâchoire sont décontractés pendant le jeu",
      "Mes bras de manchette ne sont pas rigides (absorption possible)",
      "Mes poignets sont souples lors des passes hautes",
      "La tension augmente clairement lors des balles difficiles ou en fin de set"
    ],
    hockey:[
      "Ma prise de bâton n’est pas trop serrée entre les actions",
      "Mes épaules descendent entre les jouées",
      "Mon cou n’est pas tendu lors des déplacements",
      "Mes bras ne sont pas collés au corps de façon rigide",
      "La tension augmente sur les mises en jeu ou en zone de pression"
    ],
    golf:[
      "Ma prise n’est pas trop serrée (pression de 4 sur 10)",
      "Mes avant-bras sont décontractés au début du back-swing",
      "Mes épaules ne remontent pas au début du swing",
      "Ma mâchoire et mon visage sont décontractés pendant le swing",
      "La tension apparaît sur les trous à enjeux ou avec des observateurs"
    ],
    cyclisme:[
      "Mes mains ne serrent pas excessivement le guidon",
      "Mes épaules ne remontent pas vers les oreilles en pédalant",
      "Mon cou est décontracté (pas de tension en regardant devant)",
      "Mes bras ont une légère flexion décontractée (absorbent les vibrations)",
      "La tension augmente en montée, en sprint ou en descente technique"
    ],
    danse:[
      "Mes épaules sont basses et ouvertes (pas contractées) tout au long",
      "Ma mâchoire est décontractée, mon expression est naturelle",
      "Les segments qui ne dansent pas sont détendus (ex : bras en attente)",
      "Ma respiration est visible et non bloquée",
      "La tension augmente sur les passages techniques ou devant un public"
    ],
    gym:[
      "Les groupes musculaires non actifs sont décontractés pendant l’exécution",
      "Mon visage est neutre (pas de grimace excessive)",
      "Mes mains ne se crispent pas en dehors des prises de barre",
      "Ma respiration ne se bloque pas dans les phases statiques",
      "La tension augmente visiblement sur les éléments difficiles ou en compétition"
    ],
    escalade:[
      "Mes avant-bras ne sont pas en permanence contractés (phénomène de pompage)",
      "Mes épaules descendent entre les mouvements",
      "Mes pieds ne poussent pas excessivement sur les prises (gaspillage d’énergie)",
      "Ma respiration est audible et régulière (pas bloquée)",
      "La tension augmente en zone de difficulté ou à l’approche d’un mouvement clé"
    ],
    aviron:[
      "Mon dos n’est pas hypertendu entre les coups",
      "Mes épaules ne remontent pas à chaque traction",
      "Ma mâchoire est décontractée pendant l’effort",
      "Mes mains tiennent la rame sans crispation excessive",
      "La tension globale augmente clairement en fin de course ou en sprint"
    ],
    baseball:[
      "Ma prise de batte est ferme mais pas crispée",
      "Mes épaules ne remontent pas avant le swing",
      "Mon avant-bras directeur est décontracté jusqu’au départ du swing",
      "Mon visage ne trahit pas l’effort avant le contact",
      "La tension augmente sur les lancers rapides ou en situation de match"
    ],
    rugby:[
      "Mes épaules ne sont pas contractées en permanence pendant le jeu",
      "Mes mains ne serrent pas le ballon trop fort entre les actions",
      "Mon cou et mes mâchoires sont décontractés hors des contacts",
      "Ma respiration n’est pas bloquée dans les phases statiques (mélée, lineout)",
      "La tension augmente sur les phases de contact ou en défense"
    ],
    general:[
      "Des segments non actifs dans le geste se contractent visiblement",
      "Mes épaules ou ma mâchoire semblent tendues pendant le mouvement",
      "La tension augmente sous pression, sous fatigue ou quand je suis observé",
      "Mes mains ou mes bras se crispent de façon involontaire",
      "Mon geste manque de fluidité à cause de cette rigidité"
    ]
  },
  // TRANSFERT
  transfert:{
    natation:[
      "Ma main accélère en cours de traction (pas une vitesse constante)",
      "La poussée se prolonge jusqu’à la cuisse (pas arrêtée à la hanche)",
      "L’eau est visiblement accélérée vers l’arrière par ma main/avant-bras",
      "Mon corps avance visiblement après chaque coup de bras",
      "Il n’y a pas de pause ou de perte d’élan entre deux tractions"
    ],
    basket:[
      "Le ballon tourne vers l’arrière (backspin) au relâché (signe d’un bon transfert)",
      "Mon poignet accompagne le tir jusqu’à la fin (main retombée vers le bas)",
      "La trajectoire du ballon est en arc, pas tendue",
      "Le ballon quitte ma main du bout des doigts (pas de la paume)",
      "Ma main reste pointée vers le panier après le relâché"
    ],
    raquette:[
      "La balle quitte la raquette avec une accélération visible",
      "Mon poignet et mon avant-bras se détendent naturellement après le contact",
      "La finition de mon geste est ample (pas coupée ou arrêtée)",
      "La trajectoire de ma balle correspond à mon intention",
      "Je ne force pas ou ne bloque pas au moment du contact"
    ],
    soccer:[
      "Le ballon quitte mon pied avec la force prévue (ni trop, ni trop peu)",
      "La trajectoire correspond à l’intention (hauteur, direction, courbe)",
      "Mon pied ne se bloque pas au moment du contact",
      "Mon corps continue dans la direction de la frappe après le contact",
      "Il n’y a pas de perte d’équilibre ou d’arrêt brutal après la frappe"
    ],
    yoga:[
      "L’effort produit au centre se ressent dans le segment final (extension, équilibre)",
      "Mes extrémités (mains, pieds) ne sont pas contractées quand elles devraient être actives",
      "La stabilité de ma posture vient du centre, pas des extrémités",
      "Je peux tenir la posture sans forcer excessivement aux extrémités",
      "L’énergie circule jusqu’à mes doigts et orteils dans les postures ouvertes"
    ],
    course:[
      "Ma propulsion est visible (phase de vol réelle, pas seulement transfert de poids)",
      "Mon pied pousse jusqu’à l’extension complète de la cheville",
      "Le bras opposé accompagne l’impulsion (coordination bras-jambe)",
      "Mon genou avant monte haut (bon transfert de la poussée en élévation)",
      "Je ne perds pas d’énergie latéralement (déplacement frontal efficace)"
    ],
    ski:[
      "Mon ski intérieur s’allège (transfert réel du poids sur le ski extérieur)",
      "Le ski extérieur fléchit sous le poids (prise de carre efficace)",
      "Ma vitesse augmente ou se maintient en sortie de virage",
      "L’énergie générée par le virage est convertie en vitesse, pas en freinage",
      "Mes skis restent parallèles et répondent à mes intentions"
    ],
    martial:[
      "Mon adversaire ou le sac reçoit clairement l’énergie de ma frappe",
      "Ma technique ne s’arrête pas avant l’impact (frappe en surface, pas en profondeur)",
      "Mon kiai ou ma contraction musculaire se produit au bon moment (impact)",
      "La trajectoire de ma technique est directe, sans détour inutile",
      "Je ne perds pas d’équilibre après la technique (transfert contrôlé)"
    ],
    volley:[
      "Le ballon quitte mon bras/main avec une accélération visible",
      "La trajectoire du smash est précise et intentionnelle",
      "Ma manchette oriente vraiment le ballon (pas seulement un bloc passif)",
      "La finition de mon geste de service est longue (pas coupée)",
      "L’énergie de mon saut est convertie en puissance de frappe"
    ],
    hockey:[
      "La rondelle atteint la cible avec la force et la direction voulues",
      "Le poignet claque en fin de tir (effet de fouet visible)",
      "Mon corps ne se déséquilibre pas après le tir",
      "Le bâton suit la direction de la cible après le tir",
      "La rondelle part avec la vitesse souhaitée selon le type de tir"
    ],
    golf:[
      "La balle part dans la direction ciblée avec la distance voulue",
      "Le divot est créé après la balle (pas avant)",
      "Le club suit la balle dans la direction de la cible après l’impact",
      "Mon poids est complètement sur le pied avant en fin de swing",
      "Mes hanches sont ouvertes vers la cible en fin de swing"
    ],
    cyclisme:[
      "Ma puissance est ressentie sur l’ensemble du tour de pédale",
      "Mon vélo accélère de façon proportionnelle à mon effort",
      "Aucune énergie n’est perdue latéralement (pas de roulis excessif du bassin)",
      "Mes pieds poussent jusqu’à l’extension quasi complète de la jambe",
      "En sprint : la vitesse augmente jusqu’à la fin"
    ],
    danse:[
      "L’énergie du mouvement atteint les extrémités (doigts, orteils, regard)",
      "Mes mains et pieds prolongent le geste jusqu’à sa fin naturelle",
      "Il n’y a pas de mouvements tronqués ou arrêtés prématurément",
      "Chaque geste a la qualité de mouvement souhaitée (fluide, percutant, suspendu)",
      "Le partenaire ou le public perçoit clairement l’intention du mouvement"
    ],
    gym:[
      "La hauteur du saut ou l’amplitude est maximale selon l’effort fourni",
      "La réception est stable et absorbe bien l’énergie",
      "Le geste final est tenu et précis",
      "L’énergie ne se perd pas en mouvements parasites",
      "Le résultat correspond à l’intention (hauteur, rotation, direction)"
    ],
    escalade:[
      "Ma main saisit la prise avec la force nécessaire",
      "L’énergie de la poussée des jambes se traduit en déplacement vers le haut",
      "Mon corps se déplace vers la prise suivante sans à-coups",
      "Mes pieds restent stables sur la prise jusqu’à la fin du mouvement",
      "Je ne glisse pas ou ne perds pas l’appui après le mouvement"
    ],
    aviron:[
      "L’embarcation accélère clairement après chaque coup",
      "La rame sort proprement de l’eau sans éclaboussure excessive",
      "Mon corps ne se déséquilibre pas après la traction",
      "Il n’y a pas de perte de vitesse due à une mauvaise sortie de rame",
      "L’énergie produite est convertie en distance par coup"
    ],
    baseball:[
      "La balle part dans la direction et avec la force prévues",
      "Le contact est au centre de la batte (sweet spot)",
      "Le follow-through est complet dans l’axe de la trajectoire voulue",
      "Mon corps ne se déséquilibre pas après le swing",
      "Mon poignet claque naturellement à la fin du swing"
    ],
    rugby:[
      "Le pass atteint le receveur avec la force et la direction voulues",
      "Le coup de pied envoie le ballon à la trajectoire prévue",
      "Mon corps continue dans la direction de l’action après le geste",
      "Il n’y a pas de perte d’équilibre après le plaquage",
      "Le geste produit le résultat tactique souhaité"
    ],
    general:[
      "L’énergie générée par mon corps atteint bien sa cible (objet, adversaire, direction)",
      "Mon segment terminal (main, pied, tête) accélère en fin de geste",
      "Je ne bloque pas ou ne freine pas le geste avant le point d’action",
      "La finition du mouvement est complète (pas coupée en cours de route)",
      "Le résultat observé correspond à l’intention (direction, force, précision)"
    ]
  },
  // ANTICIPATION
  anticipation:{
    natation:[
      "Je déclenche ma rotation avant que le bras opposé ne termine sa poussée",
      "Ma respiration est anticipée (rotation de tête avant le besoin d’air)",
      "Mon bras entre dans l’eau avant que l’autre n’ait fini sa traction",
      "Mon virage est préparé plusieurs brasses avant le mur",
      "Je ne m’arrête ou ne fléchis pas en attendant de reprendre le mouvement"
    ],
    basket:[
      "Je me déplace vers ma position de tir avant de recevoir la balle",
      "Ma préparation (mise en position de tir) commence dès que je reçois la balle",
      "Mon regard identifie l’espace libre avant d’engager le dribble",
      "Je lis la défense et ajuste avant que la pression arrive",
      "Je réagis avant que l’adversaire ait complété son déplacement"
    ],
    raquette:[
      "Je commence à me déplacer avant que la balle n’ait quitté la raquette adverse",
      "Je lis la position du corps de l’adversaire pour deviner la direction",
      "Ma préparation (back-swing) est complète avant l’arrivée de la balle",
      "Je reviens en position centrale entre chaque échange",
      "Mon pied d’appui est planté avant que la balle arrive"
    ],
    soccer:[
      "Je regarde autour de moi avant de recevoir le ballon",
      "Mon orientation et ma touche de balle sont préparées avant l’impact",
      "Je me démarque avant que mon coéquipier regarde vers moi",
      "Je lis la trajectoire du ballon tôt et me positionne en conséquence",
      "Ma décision (passer, tirer, dribbler) est prise avant de recevoir le ballon"
    ],
    martial:[
      "Je détecte les intentions de l’adversaire avant qu’il n’engage (lecture posturale)",
      "Ma défense répond aux mouvements adverses, pas à l’impact",
      "Je place mon garde ou mon déplacement avant que la technique adverse soit lancée",
      "Je ne réagis pas uniquement aux mains (je lis le corps entier)",
      "Mon contre-attaque est déclenché pendant ou juste après la technique adverse (pas longtemps après)"
    ],
    raquette2:[
      "Je commence à me déplacer avant que la balle n’ait quitté la raquette adverse",
      "Ma préparation est complète avant l’arrivée de la balle",
      "Je reviens en position centrale entre chaque échange",
      "Je lis la position du joueur adverse pour prévoir la direction",
      "Mon pied d’appui est planté avant que la balle arrive"
    ],
    volley:[
      "Je me déplace vers la zone de réception avant que le ballon ne soit frappé",
      "Je lis la position des bras adverses pour deviner la direction du smash",
      "Ma préparation est complète avant l’arrivée du ballon",
      "Je couvre la zone et me positionne avant de voir la trajectoire finale",
      "Mon saut de smash est planifié avant la passe haute du passeur"
    ],
    hockey:[
      "Je me déplace vers l’espace libre avant que la rondelle y arrive",
      "Je lis la direction du jeu depuis la posture du porteur de rondelle",
      "Ma décision est prise avant de recevoir la passe",
      "Je crée de l’espace avant d’en avoir besoin",
      "Je ne suis pas surpris par des situations de jeu prévisibles"
    ],
    baseball:[
      "Je lis la prise du lanceur pour anticiper le type de lancer",
      "En défense, je me positionne selon la situation de jeu",
      "Je démarre en direction de la balle avant qu’elle ne touche le sol",
      "Mon chargement est bien timé par rapport au release du lanceur",
      "Ma décision de swing est prise au bon moment"
    ],
    rugby:[
      "Je lis le jeu adverse pour prévoir où la balle va aller",
      "Je me positionne en soutien avant que le porteur ne soit plaqué",
      "Ma ligne de course est amorcée avant de recevoir le ballon",
      "Je détecte les espaces libres avant qu’ils ne se ferment",
      "Je réagis à la posture adverse, pas seulement à ses actions"
    ],
    general:[
      "Je me déplace ou me prépare avant que la situation soit complètement engagée",
      "Je lis les indices disponibles (position, trajectoire, rythme) avant d’agir",
      "Ma préparation est complète avant d’avoir besoin d’agir",
      "Je ne suis pas surpris par des situations prévisibles",
      "Mon action est déclenchée avant que la fenêtre d’opportunité se ferme"
    ]
  }
};

// ── Deep-dive points after family identified ──────────────────────────────────
var DEEP = {
  f1:{
    natation:["Je bouge les bras sans que le tronc ne tourne","Mon corps reste plat (pas de rotation axiale)","Je «pagaie» sans engager l’épaule","Ma propulsion vient seulement des bras, pas du corps entier","Mes deux bras semblent travailler de façon symétrique et indépendante"],
    basket:["Mon tir part uniquement du bras (pas des jambes)","Mes jambes ne poussent pas vers le haut pendant le tir","Mon tronc ne s’engage pas dans le geste","Ma détente est absente ou très faible","Le tir manque de portée ou de précision malgré un bon positionnement"],
    volley:["Je frappe le ballon avec seulement le bras (pas de rotation du tronc)","Mon impulsion au saut est faible car les bras ne participent pas","Mes épaules ne tournent pas avant la frappe","Ma manchette manque de force car le tronc ne s’engage pas","Le geste est en bloc (haut et bas du corps indépendants)"],
    hockey:["Mon tir vient uniquement du bras (pas de rotation des hanches)","Je ne transfère pas mon poids lors du tir","Mon tronc ne s’ouvre pas vers la cible","La rondelle manque de vitesse malgré un effort visible","Le geste de tir est rigide et cloisonné"],
    golf:["Mon swing vient des bras et non des hanches","Mon tronc ne tourne pas avant les épaules","Je manque de distance malgré un effort important","Mon poids ne se transfère pas correctement","Le swing semble en bloc, sans séquence claire"],
    cyclisme:["Ma puissance vient uniquement de la poussée (pas de traction en clip)","Mon bassin compense le manque de coordination","La cheville ne participe pas au mouvement de pédale","Mon élan est régulier mais faible","Mes deux jambes ne semblent pas travailler en chaîne"],
    danse:["Le mouvement semble compartimenté (bras indépendants du corps)","Le centre ne génère pas le mouvement, les membres travaillent seuls","Le geste manque de fluidité entre les segments","L’énergie ne circule pas jusqu’aux extrémités","Les transitions manquent de continuité car le centre n’initie pas"],
    gym:["L’appel au saut vient des bras sans poussée des jambes","La roulade n’est pas segmentée, elle se fait en bloc","Les membres travaillent indépendamment du tronc","L’impulsion manque de puissance car la chaîne est rompue","La réception est dure car le corps ne prépare pas l’absorption"],
    escalade:["Je me déplace uniquement à la force des bras","Mes jambes ne poussent pas : elles sont passives","Mon corps reste loin du mur (hanches non engagées)","Je tire uniquement avec les bras sans pousser les pieds","Le mouvement coûte cher en énergie pour un résultat limité"],
    aviron:["Je tire avec les bras sans pousser les jambes d’abord","Mon dos bascule avant que les jambes ne soient étendues","La chaîne jambes-dos-bras n’est pas respectée","Je produis de l’effort sans avancer proportionnellement","Le bateau ne glisse pas malgré une force apparente"],
    general:["Je bouge un membre sans engager le tronc","Le mouvement semble cloisonné (haut vs bas du corps)","L’élan du mouvement ne se propage pas","Le geste manque de fluidité entre le bas et le haut du corps","Mon effort n’est pas converti en résultat proportionnel"]
  },
  f2:{
    natation:["Ma traction a une vitesse uniforme du début à la fin","Il n’y a pas de phase d’accélération visible sous l’eau","Mon bras «glisse» plutôt que de pousser","Ma poussée finale n’est pas plus forte que ma traction","Mon avancement perçu s’arrête avant la fin du geste"],
    basket:["Je pousse le ballon à vitesse constante du bas en haut","Il n’y a pas d’explosion visible au niveau du poignet","Le ballon part trop tôt ou trop lentement","Mon saut et mon tir ne sont pas synchronisés","Le tir manque de portée malgré un bon positionnement"],
    general:["Le geste est géométriquement correct mais manque de punch","La vitesse est uniforme là où elle devrait piquer","Il n’y a pas de moment d’explosion visible","Le résultat du geste (distance, force, précision) est en dessous de l’attendu","Je fais le bon geste mais sans l’énergie suffisante au bon moment"]
  },
  f3:{
    natation:["Mes jambes tombent en dessous de la surface","Mon bassin est bas dans l’eau, créant de la résistance","Ma tête est trop haute ou trop basse","Mon corps ne forme pas une ligne droite dans l’eau","L’alignement se dégrade quand je fatigue"],
    basket:["Mes pieds ne sont pas à largeur d’épaules avant le tir","Je suis sur mes talons au moment d’initier le tir","Mon tronc se penche en arrière pendant le tir","Ma base est instable (je déséquilibre après le tir)","Ma tête ne regarde pas la cible avant de tirer"],
    yoga:["Mon bassin bascule excessivement dans la posture","Mes épaules s’élèvent ou s’affaissent","Mes articulations portantes ne sont pas alignées","Ma colonne s’arrondit dans des postures qui demandent de l’allongement","La posture est compensée par une autre partie du corps"],
    general:["Mon corps n’est pas prêt avant de commencer le geste","Mon alignement est défectueux avant même que le mouvement ne commence","Je compense le mauvais alignement avec un effort excessif ailleurs","Ma posture de départ change selon le niveau de fatigue","Je suis instable pendant ou après l’action"]
  },
  f4:{
    natation:["Mes épaules remontent à chaque respiration","Mes mains entrent dans l’eau de façon crampée","Mon cou est tendu pendant la nage","Ma respiration est saccadée ou bloquée","La tension augmente clairement après quelques longueurs"],
    basket:["Ma main de soutien pousse sur le ballon au relâché","Mon poignet est bloqué au moment du tir","Mon bras d’appui ne s’écarte pas naturellement","Ma mâchoire est serrée au moment du tir","La tension est plus visible quand je suis surveillé"],
    general:["Des muscles non actifs sont visiblement contractés","Le geste manque de souplesse et de fluidité","La tension augmente avec la fatigue ou la pression","Mon geste semble «rigide» comparé au modèle","Le bruit de mon déplacement ou ma respiration trahit la tension"]
  },
  f5:{
    basket:["Je reçois la balle et ensuite je cherche quoi faire","Je suis toujours derrière l’action adverse","Mon regard est sur le ballon, pas sur le terrain","Je réagis après que l’adversaire ait déjà engagé","Je me fais surprendre par des situations prévisibles"],
    raquette:["Ma préparation commence après que la balle ait rebondi","Je suis souvent en déséquilibre ou sans temps pour bien frapper","Je subis les balles au lieu de les attaquer","Mon regard reste sur ma raquette au lieu de lire l’adversaire","Je manque de temps pour effectuer un bon tir"],
    martial:["Je réagis à l’impact et non aux signaux précurseurs","Mes parades arrivent trop tard","Mon regard suit les mains adverses plutôt que le corps entier","Je suis souvent touché par des techniques que je voyais venir","Ma contre-attaque arrive longtemps après la technique adverse"],
    general:["Je réagis toujours après que la situation soit déjà engagée","Mon déplacement est toujours en retard","Je manque de temps pour effectuer le geste correctement","Je suis surpris par des situations prévisibles","Je lis l’information trop tard pour en profiter"]
  },
  f6:{
    natation:["Ma main entre dans l’eau à plat (paume vers le bas) au lieu du bout des doigts","Ma traction n’accélère pas vers la fin","Je bloque mon coude au lieu de le laisser guider","La poussée n’atteint pas la cuisse (s’arrête trop tôt)","Mon mouvement de bras semble court ou tronqué"],
    basket:["Le ballon ne tourne pas (pas de backspin au relâché)","Mon poignet ne s’incline pas vers l’avant au relâché","Je «pousse» le ballon au lieu de le «le faire partir»","Ma finition est bloquée (main reste rigide après le relâché)","La trajectoire du ballon est trop tendue (pas assez d’arc)"],
    general:["Mon geste s’arrête avant que l’énergie atteigne la cible","Je bloque le segment terminal au lieu de le relâcher","Le résultat (force, précision, distance) est nettement en dessous de l’effort fourni","Mon geste ressemble à une poussée là où il devrait y avoir un fouet","La finition du mouvement est courte ou abrupte"]
  }
};

// ── Families ──────────────────────────────────────────────────────────────────
var families = {
  f1:{num:1,title:"Rupture de la chaîne cinétique",color:"#4f9cf9",bg:"rgba(79,156,249,0.08)",border:"rgba(79,156,249,0.2)",icon:"⛓️",
    description:"Le mouvement est produit en bloc ou par segments isolés, sans transfert d’énergie de la base vers l’extrémité.",
    signes:"Mouvement rigide ou en blocs. Les segments du bas et du haut du corps ne se coordonnent pas.",
    objectif:"Initier chaque mouvement par la base (bassin/tronc) et laisser l’énergie se propager segment par segment.",
    exercice:"Exercices de dissociation bassin/épaules, gestes en chaîne simplifiés."},
  f2:{num:2,title:"Défaut de timing et d’accélération",color:"#a78bfa",bg:"rgba(167,139,250,0.08)",border:"rgba(167,139,250,0.2)",icon:"⏱️",
    description:"La géométrie du geste est correcte, mais l’accélération arrive au mauvais moment ou est absente.",
    signes:"Le geste ressemble au modèle mais manque d’explosion. La vitesse est constante là où elle devrait piquer.",
    objectif:"Identifier le moment précis d’accélération maximale et produire une impulsion décisive.",
    exercice:"Indicateurs sonores ou visuels pour marquer le moment d’accélération. Comparer en vidéo avec le modèle."},
  f3:{num:3,title:"Désorganisation posturale de base",color:"#f97316",bg:"rgba(249,115,22,0.08)",border:"rgba(249,115,22,0.2)",icon:"🧐",
    description:"L’alignement du corps (bassin, centre de gravité, orientation des segments) est inadéquat avant ou pendant l’action.",
    signes:"Posture affaissée, bassin mal orienté, poids mal réparti. Le corps n’est pas prêt avant que le geste commence.",
    objectif:"Établir une posture de départ fonctionnelle : alignement du bassin, répartition équilibrée du poids.",
    exercice:"Vérifier la posture de départ en vidéo. Travailler le gainage et la proprioception."},
  f4:{num:4,title:"Coactivation musculaire parasite",color:"#f43f5e",bg:"rgba(244,63,94,0.08)",border:"rgba(244,63,94,0.2)",icon:"⚡",
    description:"Des groupes musculaires non impliqués se contractent involontairement, créant de la rigidité. C’est un indicateur que la tâche dépasse les ressources cognitives actuelles.",
    signes:"Tension visible dans les épaules, la mâchoire, les poings. Rigidité qui s’accentue sous pression.",
    objectif:"Réduire la charge cognitive pour permettre un relâchement musculaire progressif.",
    exercice:"Simplifier la tâche. Exercices de relâchement ciblé sur les segments parasites identifiés."},
  f5:{num:5,title:"Défaut d’anticipation perceptivo-motrice",color:"#22d3a0",bg:"rgba(34,211,160,0.08)",border:"rgba(34,211,160,0.2)",icon:"👁️",
    description:"L’action est déclenchée après l’information plutôt qu’avant. Le débutant réagit, l’expert anticipe.",
    signes:"Toujours en retard. L’action démarre trop tard par rapport à l’adversaire ou à l’objet.",
    objectif:"Lire les indices précoces (posture, trajectoire, contexte) pour initier l’action avant que l’information soit complète.",
    exercice:"Exercices de lecture de jeu sans ballon. Comparer en vidéo le moment de déclenchement vs le modèle."},
  f6:{num:6,title:"Mauvaise gestion du transfert d’énergie segmentaire",color:"#facc15",bg:"rgba(250,204,21,0.08)",border:"rgba(250,204,21,0.2)",icon:"🌊",
    description:"L’athlète n’a pas encore intégré le relâchement progressif des segments distaux pour créer un effet d’accélération en cascade.",
    signes:"L’énergie ne se rend pas à la cible. Le geste semble forcé ou tronqué. Le terminal ne s’accélère pas.",
    objectif:"Relâcher progressivement les segments distaux pour permettre l’accélération en cascade.",
    exercice:"Pratiquer en ralenti en se concentrant sur le relâchement du segment terminal."}
};

// ── Tree steps ────────────────────────────────────────────────────────────────
var steps = {
  start:{id:'start',tag:'Étape 1 — Type d’habileté',question:"Ton habileté motrice est-elle fermée ou ouverte ?",
    info:"Une habileté motrice <strong>fermée</strong> se réalise dans un environnement stable et prévisible — tu contrôles le moment où tu l'inities. Une habileté <strong>ouverte</strong> s’adapte en temps réel à un environnement changeant.",
    choices:[
      {label:"Habileté fermée",desc:"Environnement stable — natation, golf, lancer franc, plongeon, ski, yoga, course…",icon:"🎯",next:'closed_posture'},
      {label:"Habileté ouverte",desc:"Environnement changeant — basketball, soccer, tennis, badminton, arts martiaux…",icon:"🔄",next:'open_anticipation'}
    ]},
  closed_posture:{id:'closed_posture',tag:'Étape 2 — Posture de départ',
    question:"Ta posture de départ est-elle fonctionnelle ?",
    obsKey:'posture',yesno:true,yes:'closed_chain',no:'result_f3'},
  closed_chain:{id:'closed_chain',tag:'Étape 3 — Chaîne cinétique',
    question:"Le mouvement est-il initié par ton tronc/bassin et se propage-t-il segment par segment vers tes membres ?",
    obsKey:'chaine',yesno:true,yes:'closed_timing',no:'result_f1'},
  closed_timing:{id:'closed_timing',tag:'Étape 4 — Timing et accélération',
    question:"Y a-t-il une accélération décisive au bon moment dans ton geste ?",
    obsKey:'timing',yesno:true,yes:'closed_tension',no:'result_f2'},
  closed_tension:{id:'closed_tension',tag:'Étape 5 — Tension musculaire',
    question:"Des muscles non impliqués se contractent-ils involontairement pendant le geste ?",
    obsKey:'tension',yesno:true,yes:'result_f4',no:'closed_transfer'},
  closed_transfer:{id:'closed_transfer',tag:'Étape 6 — Transfert d’énergie',
    question:"L’énergie générée par ton corps arrive-t-elle bien jusqu’à ta cible ?",
    obsKey:'transfert',yesno:true,yes:'no_error',no:'result_f6'},
  open_anticipation:{id:'open_anticipation',tag:'Étape 2 — Anticipation',
    question:"Est-ce que tu déclenches ton action avant d’avoir toute l’information disponible ?",
    obsKey:'anticipation',yesno:true,yes:'open_posture',no:'result_f5'},
  open_posture:{id:'open_posture',tag:'Étape 3 — Posture de départ',
    question:"Ta posture de départ est-elle fonctionnelle avant chaque action ?",
    obsKey:'posture',yesno:true,yes:'open_chain',no:'result_f3'},
  open_chain:{id:'open_chain',tag:'Étape 4 — Chaîne cinétique',
    question:"Le mouvement est-il initié par ton tronc/bassin et se propage-t-il vers tes membres ?",
    obsKey:'chaine',yesno:true,yes:'open_tension',no:'result_f1'},
  open_tension:{id:'open_tension',tag:'Étape 5 — Tension musculaire',
    question:"Des muscles non impliqués se contractent-ils involontairement pendant le geste ?",
    obsKey:'tension',yesno:true,yes:'result_f4',no:'open_transfer'},
  open_transfer:{id:'open_transfer',tag:'Étape 6 — Transfert d’énergie',
    question:"L’énergie générée par ton corps arrive-t-elle bien jusqu’à ta cible ?",
    obsKey:'transfert',yesno:true,yes:'no_error',no:'result_f6'},
  no_error:{id:'no_error',special:'noerror'},
  result_f1:{id:'result_f1',family:'f1'},result_f2:{id:'result_f2',family:'f2'},
  result_f3:{id:'result_f3',family:'f3'},result_f4:{id:'result_f4',family:'f4'},
  result_f5:{id:'result_f5',family:'f5'},result_f6:{id:'result_f6',family:'f6'}
};

// ── Helpers ───────────────────────────────────────────────────────────────────
function actKey(){return detectActivity(studentInfo.activite||'');}

function getObsPoints(obsKey){
  var ak=actKey();
  var pool=OBS[obsKey];
  if(!pool) return [];
  return pool[ak]||pool.general||[];
}

function getDeepPoints(fk){
  var ak=actKey();
  var pool=DEEP[fk];
  if(!pool) return [];
  return pool[ak]||pool.general||[];
}

function escHTML(s){
  return (s||'').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function updateProgress(sid){
  var dots=document.querySelectorAll('.step-dot');
  var sm={ident:0,start:1,closed_posture:2,open_anticipation:2,closed_chain:3,open_posture:3,closed_timing:4,open_chain:4,closed_tension:4,open_tension:4,closed_transfer:5,open_transfer:5};
  var results=['result_f1','result_f2','result_f3','result_f4','result_f5','result_f6','no_error'];
  var isR=results.indexOf(sid)>=0;
  var cur=isR?6:(sm[sid]!==undefined?sm[sid]:0);
  for(var i=0;i<dots.length;i++){dots[i].classList.remove('active','done');if(i<cur)dots[i].classList.add('done');else if(i===cur)dots[i].classList.add('active');}
  if(isR){for(var i=0;i<dots.length;i++)dots[i].classList.add('done');}
}

function buildBreadcrumb(){
  if(!breadcrumbTrail.length)return '';
  var h='<div class="breadcrumb">';
  for(var i=0;i<breadcrumbTrail.length;i++){h+='<span>'+breadcrumbTrail[i]+'</span>';if(i<breadcrumbTrail.length-1)h+='<span class="sep">›</span>';}
  return h+'</div>';
}

function saveStepObs(sid){
  var checks=document.querySelectorAll('.obs-check:checked');
  var free=document.getElementById('obs_free_'+sid);
  var checked=[];
  for(var i=0;i<checks.length;i++) checked.push(checks[i].dataset.label);
  stepObservations[sid]={checked:checked,free:free?free.value.trim():''};
}

function toggleCheck(el){
  var item=el.closest('.check-item');
  if(item) item.classList.toggle('checked',el.checked);
}

// ── Render ────────────────────────────────────────────────────────────────────
function render(){
  updateProgress(currentStep);
  if(currentStep==='ident'){renderIdent();return;}
  var step=steps[currentStep];
  if(step&&step.family){renderResult(step.family);return;}
  if(step&&step.special==='noerror'){renderNoError();return;}
  renderQuestion(step);
}

// ── Identification ────────────────────────────────────────────────────────────
function renderIdent(){
  var today=new Date();
  var ds=today.getFullYear()+'-'+String(today.getMonth()+1).padStart(2,'0')+'-'+String(today.getDate()).padStart(2,'0');
  var h='<div class="card"><span class="step-tag">Identification — Étape préliminaire</span><h2>Identifie-toi et décris ta séance</h2>';
  h+='<div class="form-grid"><div class="form-group"><label>Nom <span class="required-badge">*</span></label><input type="text" id="nom" placeholder="Nom de famille"></div>';
  h+='<div class="form-group"><label>Prénom <span class="required-badge">*</span></label><input type="text" id="prenom" placeholder="Prénom"></div></div>';
  h+='<div class="form-grid"><div class="form-group"><label>Date</label><input type="date" id="date" value="'+ds+'"></div>';
  h+='<div class="form-group"><label>N° séance <span class="required-badge">*</span></label><input type="number" id="seance" placeholder="Ex : 3" min="1" max="20"></div></div>';
  h+='<div class="form-grid"><div class="form-group"><label>Activité physique <span class="required-badge">*</span></label><input type="text" id="activite" placeholder="Ex : Natation, Basketball, Arts martiaux…"></div>';
  h+='<div class="form-group"><label>Technique analysée <span class="required-badge">*</span></label><input type="text" id="technique" placeholder="Ex : Crawl, Lancer franc, Mae-geri…"></div></div></div>';
  h+='<div class="card" style="margin-top:0"><span class="step-tag">Objectifs — Avant l’analyse</span><h2>Définis tes objectifs et indicateurs de performance</h2><p>Ces objectifs guident ton analyse. Tu pourras les réviser après avoir identifié ta famille d’erreurs.</p>';
  h+='<div class="obj-section"><div class="obj-section-title">🎯 Objectif global <span class="required-badge">*</span></div>';
  h+='<div class="form-group"><textarea id="objGlobal" placeholder="Décris en une phrase l’amélioration globale que tu vises. Ex : Améliorer l’efficacité de ma technique de crawl pour réduire mon temps sur 50m."></textarea></div></div>';
  h+='<div class="obj-section"><div class="obj-section-title">📋 Objectifs stratégiques <span style="font-weight:400;opacity:.7">(1 min, 5 max)</span> <span class="required-badge">*</span></div>';
  h+='<div id="objList"></div><button class="btn-add-obj" id="btnAddObj" onclick="addObjective()">+ Ajouter un objectif stratégique</button></div>';
  h+='<div id="identError" class="validation-error"></div>';
  h+='<button class="btn-primary" onclick="submitIdent()" style="margin-top:20px">Démarrer l’analyse vidéo →</button></div>';
  document.getElementById('tree').innerHTML=h;
  addObjective();
  window.scrollTo({top:0,behavior:'smooth'});
}

function addObjective(prefill){
  var list=document.getElementById('objList');
  if(!list)return;
  var items=list.querySelectorAll('.obj-item');
  if(items.length>=5)return;
  objCount++;
  var id='obj_'+objCount;
  var div=document.createElement('div');
  div.className='obj-item';div.id=id;
  var canRemove=items.length>0;
  var hints=["Ex : « Mon coude reste bas pendant toute la traction »","Ex : « Mon bassin est stable en position de départ »","Ex : « Je me déplace avant que la balle arrive »"];
  div.innerHTML='<div class="obj-item-header"><span class="obj-num">Objectif stratégique '+(items.length+1)+'</span>'+(canRemove?'<button class="btn-remove-obj" onclick="removeObjective(\''+id+'\')">Supprimer</button>':'')+'</div>'+
    '<div class="form-group" style="margin-bottom:12px"><label>Description <span class="required-badge">*</span></label><input type="text" class="obj-desc" id="desc_'+id+'" placeholder="Décris ce que tu veux améliorer avec précision" value="'+(prefill&&prefill.desc?escHTML(prefill.desc):'')+'"></div>'+
    '<div class="form-group"><label>Indicateurs de performance <span class="required-badge">* (min. 3)</span></label><div class="indicators-list" id="inds_'+id+'"></div>'+
    '<button class="btn-add-indicator" onclick="addIndicator(\''+id+'\')">+ Ajouter un indicateur</button>'+
    '<div class="ind-hint">'+hints[items.length%hints.length]+'</div></div>';
  list.appendChild(div);
  if(prefill&&prefill.indicators&&prefill.indicators.length){
    for(var j=0;j<prefill.indicators.length;j++) addIndicator(id,prefill.indicators[j]);
    while(document.querySelectorAll('#inds_'+id+' .indicator-row').length<3) addIndicator(id,'');
  } else {addIndicator(id);addIndicator(id);addIndicator(id);}
  updateObjNumbers();
  var btn=document.getElementById('btnAddObj');
  if(btn) btn.disabled=(list.querySelectorAll('.obj-item').length>=5);
}

function removeObjective(id){var el=document.getElementById(id);if(el)el.parentNode.removeChild(el);updateObjNumbers();var btn=document.getElementById('btnAddObj');if(btn)btn.disabled=false;}

function updateObjNumbers(){
  var items=document.querySelectorAll('.obj-item');
  for(var i=0;i<items.length;i++){
    var n=items[i].querySelector('.obj-num');if(n)n.textContent='Objectif stratégique '+(i+1);
    var rb=items[i].querySelector('.btn-remove-obj');
    if(rb) rb.style.display=i===0?'none':'';
  }
}

function addIndicator(objId,val){
  var list=document.getElementById('inds_'+objId);if(!list)return;
  if(!indCounters[objId])indCounters[objId]=0;indCounters[objId]++;
  var iid=objId+'_ind_'+indCounters[objId];
  var row=document.createElement('div');row.className='indicator-row';row.id=iid;
  row.innerHTML='<input type="text" placeholder="Ce que tu vas observer en vidéo pour mesurer cet objectif" value="'+escHTML(val||'')+'" id="val_'+iid+'"><button class="btn-remove-ind" onclick="removeIndicator(\''+iid+'\')">✕</button>';
  list.appendChild(row);
}
function removeIndicator(iid){var el=document.getElementById(iid);if(el)el.parentNode.removeChild(el);}

function collectObjectives(){
  var r=[];var items=document.querySelectorAll('.obj-item');
  for(var i=0;i<items.length;i++){
    var di=items[i].querySelector('.obj-desc');var desc=di?di.value.trim():'';
    var ii=items[i].querySelectorAll('.indicator-row input');var inds=[];
    for(var j=0;j<ii.length;j++){var v=ii[j].value.trim();if(v)inds.push(v);}
    r.push({desc:desc,indicators:inds});
  }
  return r;
}

function submitIdent(){
  var nom=document.getElementById('nom').value.trim();
  var prenom=document.getElementById('prenom').value.trim();
  var date=document.getElementById('date').value;
  var seance=document.getElementById('seance').value.trim();
  var activite=document.getElementById('activite').value.trim();
  var technique=document.getElementById('technique').value.trim();
  var objGlobal=document.getElementById('objGlobal').value.trim();
  var errEl=document.getElementById('identError');
  if(!nom||!prenom||!seance||!activite||!technique){errEl.textContent='⚠️ Remplis tous les champs obligatoires.';errEl.style.display='block';return;}
  if(!objGlobal){errEl.textContent='⚠️ Ton objectif global est obligatoire.';errEl.style.display='block';return;}
  var objs=collectObjectives();
  if(!objs.length||!objs[0].desc){errEl.textContent='⚠️ Au moins un objectif stratégique est requis.';errEl.style.display='block';return;}
  for(var i=0;i<objs.length;i++){
    if(!objs[i].desc){errEl.textContent='⚠️ Décris l’objectif stratégique '+(i+1)+'.';errEl.style.display='block';return;}
    if(objs[i].indicators.length<3){errEl.textContent='⚠️ L’objectif '+(i+1)+' doit avoir au moins 3 indicateurs remplis.';errEl.style.display='block';return;}
  }
  studentInfo={nom:nom,prenom:prenom,date:date,seance:seance,activite:activite,technique:technique,objGlobal:objGlobal,objectives:objs};
  navHistory.push('ident');currentStep='start';render();
}

// ── Question ──────────────────────────────────────────────────────────────────
function renderQuestion(step){
  var h=buildBreadcrumb();
  var obsPoints=step.obsKey?getObsPoints(step.obsKey):[];
  var ak=actKey();

  // Observation panel
  if(obsPoints.length){
    h+='<div class="obs-panel">';
    h+='<div class="obs-panel-title">📹 Observe ta vidéo — <em style="font-weight:400;text-transform:none;letter-spacing:0">coche ce que tu constates</em></div>';

    // Activity-specific example
    var exampleMap={
      posture:{natation:"En natation : observe le moment juste avant que ton bras entre dans l’eau. Ton corps est-il horizontal ? Ton bassin est-il à la surface ?",basket:"Au basketball : observe ta position juste avant de déclencher le tir. Tes genoux sont-ils fléchis ? Ton poids est-il sur l’avant du pied ?",raquette:"Au tennis/badminton : observe ta position d’attente entre les points. Es-tu en position athlétique, genoux fléchis, raquette devant toi ?",yoga:"En yoga : observe la posture de départ avant chaque transition. Ton bassin est-il neutre ? Tes épaules sont-elles loin des oreilles ?",course:"En course : observe les premiers mètres. Ton tronc est-il légèrement incliné en avant ? Ton regard est-il devant toi ?",ski:"En ski : observe ta position en haut de la piste avant d’engager. Tes genoux sont-ils fléchis ? Ton poids est-il centré ?",martial:"En arts martiaux : observe ta garde initiale. Ton centre de gravité est-il bas ? Ta garde te protège-t-elle sans te bloquer ?",general:"Observe ta position juste avant que le geste commence. Ton corps est-il prêt à agir efficacement ?"},
      chaine:{natation:"En natation (crawl) : est-ce que ton tronc pivote avant que ton bras ne commence à tirer ? La rotation de l’épaule précède-t-elle la traction de la main ?",basket:"Au basketball (lancer franc) : est-ce que tes jambes poussent vers le haut avant que ton bras ne monte ? L’énergie monte-t-elle des jambes vers le bout des doigts ?",raquette:"Au tennis : est-ce que tes hanches tournent avant tes épaules ? Et tes épaules avant ton bras ? Le bras arrive-t-il en dernier ?",yoga:"En yoga : l’effort part-il de ton centre (bassin, abdominaux) avant de se propager vers tes bras ou jambes ?",ski:"En ski : la rotation débute-t-elle par les hanches ? Tes genoux suivent-ils, puis les chevilles ?",martial:"En arts martiaux : ta frappe part-elle du bassin (koshi) avant que l’épaule et le bras ne s’engagent ?",course:"En course : ta foulée est-elle initiée par la hanche ? Ton bras balançoir est-il coordonné avec la jambe opposée ?",general:"Le mouvement part-il de ton centre (bassin/tronc) avant de se propager vers tes membres ?"},
      timing:{natation:"En natation : y a-t-il une accélération visible en milieu de traction (pas une vitesse constante du début à la fin) ?",basket:"Au tir en basketball : y a-t-il une explosion visible au moment où le ballon quitte ta main ?",raquette:"Au tennis/badminton : l’accélération de ta raquette est-elle maximale exactement au moment du contact ?",ski:"En ski : le transfert de poids d’un ski à l’autre se fait-il au bon moment (sommet du virage) ?",martial:"En arts martiaux : ta frappe accélère-t-elle jusqu’à l’impact, sans ralentir avant le contact ?",course:"En course : ton contact au sol est-il bref ? Ta propulsion se produit-elle clairement derrière ton corps ?",general:"Y a-t-il une phase d’accélération claire dans le geste ? Le mouvement ne ralentit-il pas avant le point d’action ?"},
      tension:{natation:"En natation : observe tes épaules et ton cou — remontent-ils à chaque coup de bras ? Tes mains entrent-elles crampées dans l’eau ?",basket:"Au basketball : ta main non-dominante pousse-t-elle encore sur le ballon au moment du relâché ? Ton poignet est-il bloqué ?",raquette:"Au tennis : ta prise est-elle trop serrée ? Tes avant-bras sont-ils contractés en permanence ?",yoga:"En yoga : ta respiration se bloque-t-elle dans les positions difficiles ? Tes mâchoires sont-elles serrées ?",martial:"En arts martiaux : tes épaules remontent-elles avant chaque technique ? Ton visage se contracte-t-il avant la frappe ?",course:"En course : tes poings sont-ils serrés ? Tes épaules oscillent-elles vers le haut ?",general:"Observe les segments qui ne travaillent pas directement — sont-ils détendus ou contractés ?"},
      anticipation:{natation:"En natation : déclenches-tu ta rotation avant que le bras opposé ait fini sa poussée ?",basket:"Au basketball : te déplaces-tu vers ta position avant de recevoir la balle ? Prends-tu ta décision avant de recevoir ?",raquette:"Au tennis/badminton : commences-tu à te déplacer avant que la balle quitte la raquette adverse ?",soccer:"Au soccer : regardes-tu autour de toi avant de recevoir le ballon ? Ta décision est-elle déjà prise à la réception ?",martial:"En arts martiaux : détectes-tu les intentions de l’adversaire avant qu’il engage ? Réagis-tu à sa posture ou à l’impact ?",general:"Agis-tu avant que la situation soit complètement dévoilée, ou toujours après ?"},
      transfert:{natation:"En natation : ta main accélère-t-elle en fin de traction ? La poussée se prolonge-t-elle jusqu’à la cuisse ?",basket:"Au basketball : le ballon tourne-t-il vers l’arrière (backspin) au relâché ? Ton poignet s’incline-t-il vers le panier après le tir ?",raquette:"Au tennis : la balle quitte-t-elle la raquette avec une accélération visible ? Ta finition est-elle ample ?",soccer:"Au soccer : le ballon suit-il l’intention visée (direction, force, hauteur) ? Ton pied ne bloque-t-il pas avant le contact ?",ski:"En ski : ton ski intérieur s’allège-t-il (transfert réel du poids) ? Ta vitesse augmente-t-elle en sortie de virage ?",martial:"En arts martiaux : l’adversaire ou le sac reçoit-il clairement l’énergie de ta frappe ? Ta technique ne s’arrête-t-elle pas en surface ?",general:"L’énergie arrive-t-elle à destination (objet, cible, direction) ? Le segment terminal accélère-t-il en fin de geste ?"}
    };

    var exMap=exampleMap[step.obsKey]||{};
    var ex=exMap[ak]||exMap.general||'';
    if(ex){
      h+='<div class="obs-example"><div class="ex-label">Exemple — '+studentInfo.activite+'</div><p>'+ex+'</p></div>';
    }

    h+='<div class="check-list">';
    for(var i=0;i<obsPoints.length;i++){
      var cid='chk_'+currentStep+'_'+i;
      h+='<div class="check-item" id="ci_'+cid+'"><input type="checkbox" class="obs-check" id="'+cid+'" data-label="'+escHTML(obsPoints[i])+'" onchange="toggleCheck(this)"><label for="'+cid+'">'+obsPoints[i]+'</label></div>';
    }
    h+='</div>';
    h+='<span class="obs-free-label">Mes observations libres</span>';
    h+='<textarea class="obs-free" id="obs_free_'+currentStep+'" placeholder="Note ici tout ce que tu observes dans ta vidéo sur ce point…"></textarea>';
    h+='</div>';
  }

  h+='<div class="card"><span class="step-tag">'+step.tag+'</span><h2>'+step.question+'</h2>';
  if(step.choices){
    h+='<div class="choices">';
    for(var i=0;i<step.choices.length;i++){var c=step.choices[i];h+='<button class="choice-btn" onclick="choose(\''+c.next+'\',\''+c.label+'\')"><div class="choice-icon">'+c.icon+'</div><div><strong>'+c.label+'</strong><span>'+c.desc+'</span></div></button>';}
    h+='</div>';
  }
  if(step.yesno){
    h+='<p style="color:var(--muted);font-size:13px;margin-bottom:16px;margin-top:4px;">Coche tes observations ci-dessus, puis réponds.</p>';
    h+='<div class="yesno"><button class="btn-yes" onclick="saveAndChoose(\''+step.yes+'\',\'✅ Oui\')"><span>✅</span> Oui</button><button class="btn-no" onclick="saveAndChoose(\''+step.no+'\',\'❌ Non\')"><span>❌</span> Non</button></div>';
  }
  h+='</div>';
  if(navHistory.length>0) h+='<div class="nav-btns"><button class="btn-back" onclick="goBack()">← Retour</button><button class="btn-restart" onclick="restart()">↺ Recommencer</button></div>';
  document.getElementById('tree').innerHTML=h;
  window.scrollTo({top:0,behavior:'smooth'});
}

function saveAndChoose(nextId,label){
  saveStepObs(currentStep);
  choose(nextId,label);
}
function choose(nextId,label){navHistory.push(currentStep);if(label)breadcrumbTrail.push(label);currentStep=nextId;render();}
function goBack(){if(navHistory.length>0){currentStep=navHistory.pop();if(breadcrumbTrail.length>0&&currentStep!=='ident')breadcrumbTrail.pop();render();}}
function restart(){navHistory=[];breadcrumbTrail=[];detectedFamily=null;studentInfo={};stepObservations={};objCount=0;indCounters={};revObjCount=0;revIndCounters={};currentStep='ident';render();}

// ── Result ────────────────────────────────────────────────────────────────────
function renderResult(fk){
  detectedFamily=fk;var f=families[fk];
  var h=buildBreadcrumb();
  h+='<div class="result-card" style="background:'+f.bg+';border:1px solid '+f.border+';">';
  h+='<div class="result-header"><div class="family-badge" style="background:rgba(0,0,0,.3);color:'+f.color+';border:1px solid '+f.border+'">'+f.icon+'</div>';
  h+='<div><div class="family-label" style="color:'+f.color+'">Famille '+f.num+' identifiée</div><h2 style="color:'+f.color+'">'+f.title+'</h2></div></div>';
  h+='<div class="result-section"><div class="result-section-title" style="color:'+f.color+'">Ce que c’est</div><p>'+f.description+'</p></div>';
  h+='<div class="result-section"><div class="result-section-title" style="color:'+f.color+'">Signes observables en vidéo</div><p>'+f.signes+'</p></div>';
  h+='<div class="sep-line"></div>';
  h+='<div class="objective-box" style="background:rgba(0,0,0,.2);color:'+f.color+';border-left-color:'+f.color+'"><div class="obj-label">🎯 Objectif de correction</div><p style="color:var(--text)">'+f.objectif+'</p></div>';
  h+='<div class="objective-box" style="background:rgba(0,0,0,.2);color:'+f.color+';border-left-color:'+f.color+'"><div class="obj-label">🔧 Piste d’action</div><p style="color:var(--text)">'+f.exercice+'</p></div>';
  h+='</div>';
  h+=renderDeepDive(fk,f);
  h+=renderSummaryBlock(f);
  h+=renderRevisedObjectives(f);
  h+='<div class="nav-btns"><button class="btn-back" onclick="goBack()">← Retour</button><button class="btn-restart" onclick="restart()">↺ Nouvelle analyse</button></div>';
  document.getElementById('tree').innerHTML=h;
  setTimeout(function(){initRevObjectives();},50);
  window.scrollTo({top:0,behavior:'smooth'});
}

// ── Deep dive ─────────────────────────────────────────────────────────────────
function renderDeepDive(fk,f){
  var pts=getDeepPoints(fk);
  if(!pts.length) return '';
  var h='<div class="deep-dive">';
  h+='<h3>🔍 Approfondissement du diagnostic — '+f.title+'</h3>';
  h+='<p class="dd-desc">Maintenant que la famille est identifiée, observe ta vidéo plus précisément. Coche les signes que tu reconnais dans ton geste.</p>';
  h+='<div class="deep-check">';
  for(var i=0;i<pts.length;i++){
    var cid='deep_'+fk+'_'+i;
    h+='<div class="deep-check-item" id="dci_'+cid+'"><input type="checkbox" id="'+cid+'" data-label="'+escHTML(pts[i])+'" onchange="toggleDeep(this)"><label for="'+cid+'">'+pts[i]+'</label></div>';
  }
  h+='</div>';
  h+='<span class="obs-free-label" style="color:var(--muted)">Observations supplémentaires sur ta famille d’erreurs</span>';
  h+='<textarea class="obs-free" id="deep_free_'+fk+'" placeholder="Décris avec tes propres mots ce que tu vois dans ta vidéo concernant cette famille d’erreurs…"></textarea>';
  h+='</div>';
  return h;
}

function toggleDeep(el){
  var item=el.closest('.deep-check-item');
  if(item) item.classList.toggle('checked',el.checked);
}

// ── Summary ───────────────────────────────────────────────────────────────────
function renderSummaryBlock(f){
  var si=studentInfo;
  var dateF=si.date?si.date.split('-').reverse().join('/'):'';
  var h='<div class="summary-card"><h3>📌 Résumé de mon analyse</h3>';
  h+='<div class="summary-row"><span class="summary-label">Étudiant(e)</span><span class="summary-value">'+si.prenom+' '+si.nom+'</span></div>';
  h+='<div class="summary-row"><span class="summary-label">Date</span><span class="summary-value">'+dateF+'</span></div>';
  h+='<div class="summary-row"><span class="summary-label">Séance</span><span class="summary-value">Séance n° '+si.seance+'</span></div>';
  h+='<div class="summary-row"><span class="summary-label">Activité</span><span class="summary-value">'+si.activite+'</span></div>';
  h+='<div class="summary-row"><span class="summary-label">Technique analysée</span><span class="summary-value">'+si.technique+'</span></div>';
  h+='<div class="summary-row"><span class="summary-label">Famille identifiée</span><span class="summary-value" style="color:'+f.color+';font-weight:600">Famille '+f.num+' — '+f.title+'</span></div>';
  h+='<div class="summary-highlight"><div class="sh-label">🎯 Objectif global initial</div><p>'+si.objGlobal+'</p></div>';
  if(si.objectives&&si.objectives.length){
    for(var i=0;i<si.objectives.length;i++){
      var obj=si.objectives[i];
      h+='<div class="summary-highlight" style="margin-top:10px;background:rgba(34,211,160,.04);border-color:rgba(34,211,160,.15)">';
      h+='<div class="sh-label" style="color:var(--accent3)">Objectif stratégique '+(i+1)+'</div>';
      h+='<p style="font-weight:500;margin-bottom:8px">'+obj.desc+'</p>';
      if(obj.indicators.length){h+='<ul style="list-style:none;padding:0;margin:0">';for(var j=0;j<obj.indicators.length;j++)h+='<li style="font-size:12px;color:var(--muted);padding:3px 0 3px 12px;border-left:2px solid rgba(34,211,160,.3);margin-bottom:4px">→ '+obj.indicators[j]+'</li>';h+='</ul>';}
      h+='</div>';
    }
  }
  // Step observations summary
  var obsKeys=Object.keys(stepObservations);
  if(obsKeys.length){
    h+='<div style="margin-top:16px"><div style="font-family:Syne,sans-serif;font-size:10px;font-weight:700;letter-spacing:.2em;text-transform:uppercase;color:var(--muted);margin-bottom:8px">Observations collectées pendant l’analyse</div>';
    for(var k=0;k<obsKeys.length;k++){
      var sk=obsKeys[k];var so=stepObservations[sk];
      if((so.checked&&so.checked.length)||so.free){
        var stepLabel={closed_posture:'Posture de départ',open_posture:'Posture de départ',closed_chain:'Chaîne cinétique',open_chain:'Chaîne cinétique',closed_timing:'Timing',closed_tension:'Tension',open_tension:'Tension',closed_transfer:'Transfert',open_transfer:'Transfert',open_anticipation:'Anticipation'};
        h+='<div class="obs-summary-block"><div class="osb-label">'+(stepLabel[sk]||sk)+'</div>';
        if(so.checked&&so.checked.length){h+='<ul>';for(var ci=0;ci<so.checked.length;ci++)h+='<li>→ '+so.checked[ci]+'</li>';h+='</ul>';}
        if(so.free)h+='<p style="font-size:12px;color:var(--muted);margin-top:6px;font-style:italic">'+so.free+'</p>';
        h+='</div>';
      }
    }
    h+='</div>';
  }
  return h+'</div>';
}

// ── Revised objectives ────────────────────────────────────────────────────────
function renderRevisedObjectives(f){
  var h='<div class="revised-section">';
  h+='<h3>↻ Révision de mes objectifs après analyse</h3>';
  h+='<p class="section-desc">Sur la base de ta famille identifiée (<strong style="color:'+f.color+'">'+f.title+'</strong>), révise tes objectifs pour qu’ils soient alignés avec ce que tu as observé.</p>';
  h+='<div class="rev-global"><label>🎯 Objectif global révisé <span class="required-badge">*</span></label>';
  h+='<textarea id="revGlobal" placeholder="Réécris ton objectif global…">'+escHTML(studentInfo.objGlobal||'')+'</textarea></div>';
  h+='<div id="revObjList"></div>';
  h+='<button class="btn-add-obj" id="btnAddRevObj" onclick="addRevObjective()">+ Ajouter un objectif stratégique révisé</button>';
  h+='<div class="action-btns" style="margin-top:24px"><button class="btn-print" onclick="printSummary()">🖨️ Imprimer</button><button class="btn-copy" onclick="copySummary()">📋 Copier le texte</button></div>';
  h+='<div class="copy-confirm" id="copyConfirm"></div></div>';
  return h;
}

function initRevObjectives(){
  var si=studentInfo;if(!si.objectives)return;
  var list=document.getElementById('revObjList');if(!list||list.children.length>0)return;
  for(var i=0;i<si.objectives.length;i++) addRevObjective(si.objectives[i]);
}

function addRevObjective(prefill){
  var list=document.getElementById('revObjList');if(!list)return;
  var items=list.querySelectorAll('.rev-obj-item');if(items.length>=5)return;
  revObjCount++;var rid='rev_'+revObjCount;
  var div=document.createElement('div');div.className='rev-obj-item';div.id=rid;
  var dv=(prefill&&prefill.desc)?escHTML(prefill.desc):'';
  div.innerHTML='<label>Objectif stratégique révisé '+(items.length+1)+'</label>'+
    '<input type="text" id="rdesc_'+rid+'" value="'+dv+'" placeholder="Décris ton objectif révisé en lien avec ta famille d’erreurs…">'+
    '<div style="font-size:11px;color:var(--muted);margin-bottom:8px;font-weight:600;text-transform:uppercase;letter-spacing:.1em">Indicateurs révisés <span class="required-badge">*</span></div>'+
    '<div id="rinds_'+rid+'"></div>'+
    '<button class="btn-add-rev-ind" onclick="addRevIndicator(\''+rid+'\')">+ Ajouter un indicateur</button>';
  list.appendChild(div);
  if(prefill&&prefill.indicators&&prefill.indicators.length){
    for(var j=0;j<prefill.indicators.length;j++) addRevIndicator(rid,prefill.indicators[j]);
    while(document.querySelectorAll('#rinds_'+rid+' .rev-ind-row').length<3) addRevIndicator(rid,'');
  } else {addRevIndicator(rid,'');addRevIndicator(rid,'');addRevIndicator(rid,'');}
  var btn=document.getElementById('btnAddRevObj');if(btn)btn.disabled=(list.querySelectorAll('.rev-obj-item').length>=5);
}

function addRevIndicator(rid,val){
  var list=document.getElementById('rinds_'+rid);if(!list)return;
  if(!revIndCounters[rid])revIndCounters[rid]=0;revIndCounters[rid]++;
  var iid=rid+'_ri_'+revIndCounters[rid];
  var row=document.createElement('div');row.className='rev-ind-row';row.id=iid;
  row.innerHTML='<input type="text" value="'+escHTML(val||'')+'" placeholder="Ce que tu vas observer en vidéo…"><button class="btn-remove-ind" onclick="removeRevInd(\''+iid+'\')">✕</button>';
  list.appendChild(row);
}
function removeRevInd(iid){var el=document.getElementById(iid);if(el)el.parentNode.removeChild(el);}

function collectRevObjectives(){
  var r=[];var items=document.querySelectorAll('.rev-obj-item');
  for(var i=0;i<items.length;i++){
    var di=items[i].querySelector('input[id^="rdesc_"]');var desc=di?di.value.trim():'';
    var ii=items[i].querySelectorAll('.rev-ind-row input');var inds=[];
    for(var j=0;j<ii.length;j++){var v=ii[j].value.trim();if(v)inds.push(v);}
    r.push({desc:desc,indicators:inds});
  }
  return r;
}

// ── Print / Copy ──────────────────────────────────────────────────────────────
function printSummary(){window.print();}

function copySummary(){
  var si=studentInfo;var f=detectedFamily?families[detectedFamily]:null;if(!f)return;
  var dateF=si.date?si.date.split('-').reverse().join('/'):'';
  var rgEl=document.getElementById('revGlobal');var revGlobal=rgEl?rgEl.value.trim():'';
  var revObjs=collectRevObjectives();
  var deepChecks=document.querySelectorAll('.deep-check-item input:checked');
  var deepFreeEl=document.getElementById('deep_free_'+detectedFamily);
  var deepFree=deepFreeEl?deepFreeEl.value.trim():'';

  var t='ANALYSE VIDÉO DE MES HABILETÉS SPORTIVES\n'+'='.repeat(46)+'\n';
  t+='Étudiant(e)      : '+si.prenom+' '+si.nom+'\n';
  t+='Date            : '+dateF+'\n';
  t+='Séance          : '+si.seance+'\n';
  t+='Activité        : '+si.activite+'\n';
  t+='Technique       : '+si.technique+'\n'+'-'.repeat(46)+'\n';
  t+='OBJECTIFS INITIAUX\n';
  t+='Objectif global : '+si.objGlobal+'\n\n';
  if(si.objectives){for(var i=0;i<si.objectives.length;i++){t+='Objectif '+(i+1)+' : '+si.objectives[i].desc+'\n';for(var j=0;j<si.objectives[i].indicators.length;j++)t+='  → '+si.objectives[i].indicators[j]+'\n';t+='\n';}}
  t+='-'.repeat(46)+'\n';
  t+='OBSERVATIONS COLLECTÉES\n';
  var obsKeys=Object.keys(stepObservations);
  var stepLabel2={closed_posture:'Posture de départ',open_posture:'Posture de départ',closed_chain:'Chaîne cinétique',open_chain:'Chaîne cinétique',closed_timing:'Timing',closed_tension:'Tension',open_tension:'Tension',closed_transfer:'Transfert',open_transfer:'Transfert',open_anticipation:'Anticipation'};
  for(var k=0;k<obsKeys.length;k++){var sk=obsKeys[k];var so=stepObservations[sk];if((so.checked&&so.checked.length)||so.free){t+='\n['+(stepLabel2[sk]||sk)+']\n';if(so.checked)for(var ci=0;ci<so.checked.length;ci++)t+='  ✔ '+so.checked[ci]+'\n';if(so.free)t+='  Note : '+so.free+'\n';}}
  t+='\n'+'-'.repeat(46)+'\n';
  t+='FAMILLE D’ERREURS IDENTIFIÉE\n';
  t+='Famille '+f.num+' — '+f.title+'\n\n';
  t+='Description : '+f.description+'\n';
  t+='Signes observés : '+f.signes+'\n';
  t+='Objectif de correction : '+f.objectif+'\n';
  t+='Piste d’action : '+f.exercice+'\n';
  if(deepChecks.length||deepFree){
    t+='\nApprofondissement :\n';
    for(var i=0;i<deepChecks.length;i++)t+='  ✔ '+deepChecks[i].dataset.label+'\n';
    if(deepFree)t+='  Note : '+deepFree+'\n';
  }
  t+='-'.repeat(46)+'\n';
  t+='OBJECTIFS RÉVISÉS APRÈS ANALYSE\n';
  t+='Objectif global révisé : '+(revGlobal||'(non rempli)')+'\n\n';
  for(var i=0;i<revObjs.length;i++){t+='Objectif révisé '+(i+1)+' : '+(revObjs[i].desc||'(non rempli)')+'\n';for(var j=0;j<revObjs[i].indicators.length;j++)t+='  → '+revObjs[i].indicators[j]+'\n';t+='\n';}

  if(navigator.clipboard){navigator.clipboard.writeText(t).then(function(){var el=document.getElementById('copyConfirm');if(el){el.textContent='✅ Texte copié dans le presse-papiers !';setTimeout(function(){el.textContent='';},3000);}});}
  else{var ta=document.createElement('textarea');ta.value=t;document.body.appendChild(ta);ta.select();document.execCommand('copy');document.body.removeChild(ta);var el=document.getElementById('copyConfirm');if(el){el.textContent='✅ Copié !';setTimeout(function(){el.textContent='';},3000);}}
}

function renderNoError(){
  var h=buildBreadcrumb();
  h+='<div class="card" style="border-color:var(--accent3)"><div style="text-align:center;padding:20px 0">';
  h+='<div style="font-size:48px;margin-bottom:16px">✅</div>';
  h+='<span class="step-tag" style="color:var(--accent3);display:block;text-align:center">Analyse complète</span>';
  h+='<h2 style="color:var(--accent3);text-align:center;margin-bottom:12px">Aucune erreur prioritaire détectée</h2>';
  h+='<p style="text-align:center">Ton mouvement semble bien organisé sur les six dimensions. Consulte ton enseignant pour aller plus loin.</p></div></div>';
  h+='<div class="nav-btns" style="justify-content:center"><button class="btn-restart" onclick="restart()">↺ Recommencer</button></div>';
  document.getElementById('tree').innerHTML=h;window.scrollTo({top:0,behavior:'smooth'});
}

render();
</script>
</body>
</html>
